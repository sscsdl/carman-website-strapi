const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["MagicLinkEE-zpQZxwba.js","strapi-D0ivxu6x.js","strapi-D6821bIJ.css","SelectRoles-Dk8gmM2V.js","useAdminRoles-CYsXOyWI.js","CreateActionEE-CGsUSBjE.js","isNil-DDTxO3mp.js","ListPage-CZ4CK6WJ.js","useLicenseLimitNotification-CO-ss1ot.js","SearchInput-BlCSDN9b.js","users-DLc-PG84.js"])))=>i.map(i=>d[i]);
import{r as g,a as B,j as e,z as R,b_ as ne,q as Z,p as G,bz as E,M,cw as ie,co as b,cx as le,cy as oe,F as ce,T as U,Z as I,I as A,U as f,b7 as Q,b2 as de,bf as ue,b4 as j,b3 as q,b6 as me,a_ as J,P,w as ge,Q as pe,aN as he,bB as xe,aR as be,a3 as fe,cz as je,L as z,cA as T,bU as o,o as $,aH as Ee,_ as Me,bD as Ae,cB as N,bK as _e,bL as Le,cC as ye}from"./strapi-D0ivxu6x.js";import{S as Se}from"./SearchInput-BlCSDN9b.js";import{g as K}from"./users-DLc-PG84.js";import{M as Ce,S as Ie}from"./SelectRoles-Dk8gmM2V.js";import"./useAdminRoles-CYsXOyWI.js";const Te=g.forwardRef((t,i)=>{const{formatMessage:p}=B();return e.jsx(R,{ref:i,startIcon:e.jsx(ne,{}),size:"S",...t,fullWidth:!0,children:p({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"})})}),Re=({onToggle:t})=>{const[i,p]=g.useState("create"),[v,w]=g.useState(""),{formatMessage:r}=B(),{toggleNotification:m}=Z(),{_unstableFormatAPIError:k,_unstableFormatValidationErrors:_}=G(),d=E(Pe,async()=>(await M(async()=>{const{ROLE_LAYOUT:a}=await import("./ModalForm-CamjQBT3.js");return{ROLE_LAYOUT:a}},[])).ROLE_LAYOUT,{combine(a,c){return[...a,...c]},defaultValue:[]}),D=E(W,async()=>(await M(async()=>{const{FORM_INITIAL_VALUES:a}=await import("./ModalForm-CamjQBT3.js");return{FORM_INITIAL_VALUES:a}},[])).FORM_INITIAL_VALUES,{combine(a,c){return{...a,...c}},defaultValue:W}),L=E(Ce,async()=>(await M(async()=>{const{MagicLinkEE:a}=await import("./MagicLinkEE-zpQZxwba.js");return{MagicLinkEE:a}},__vite__mapDeps([0,1,2,3,4]))).MagicLinkEE),[h]=ie(),y=r({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}),O=async(a,{setErrors:c})=>{const l=await h({...a,roles:a.roles??[]});"data"in l?(l.data.registrationToken&&w(l.data.registrationToken),F()):(m({type:"danger",message:k(l.error)}),me(l.error)&&l.error.name==="ValidationError"&&c(_(l.error)))},F=()=>{C?p(C):t()},{buttonSubmitLabel:S,isDisabled:x,next:C}=we[i];return L?e.jsx(b.Root,{defaultOpen:!0,onOpenChange:t,children:e.jsxs(b.Content,{children:[e.jsx(b.Header,{children:e.jsx(le,{label:y,children:e.jsx(oe,{isCurrent:!0,children:y})})}),e.jsx(ce,{method:i==="create"?"POST":"PUT",initialValues:D??{},onSubmit:O,validationSchema:ve,children:({isSubmitting:a})=>e.jsxs(e.Fragment,{children:[e.jsx(b.Body,{children:e.jsxs(U,{direction:"column",alignItems:"stretch",gap:6,children:[i!=="create"&&e.jsx(L,{registrationToken:v}),e.jsxs(I,{children:[e.jsx(A,{variant:"beta",tag:"h2",children:r({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"User details"})}),e.jsx(I,{paddingTop:4,children:e.jsx(U,{direction:"column",alignItems:"stretch",gap:1,children:e.jsx(f.Root,{gap:5,children:Ue.map(c=>c.map(({size:l,...n})=>e.jsx(f.Item,{m:l,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(Q,{...n,disabled:x,label:r(n.label),placeholder:r(n.placeholder)})},n.name)))})})})]}),e.jsxs(I,{children:[e.jsx(A,{variant:"beta",tag:"h2",children:r({id:"global.roles",defaultMessage:"User's role"})}),e.jsx(I,{paddingTop:4,children:e.jsxs(f.Root,{gap:5,children:[e.jsx(f.Item,{col:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(Ie,{disabled:x})}),d.map(c=>c.map(({size:l,...n})=>e.jsx(f.Item,{col:l,direction:"column",alignItems:"stretch",children:e.jsx(Q,{...n,disabled:x,label:r(n.label),placeholder:n.placeholder?r(n.placeholder):void 0,hint:n.hint?r(n.hint):void 0})},n.name)))]})})]})]})}),e.jsxs(b.Footer,{children:[e.jsx(R,{variant:"tertiary",onClick:t,type:"button",children:r({id:"app.components.Button.cancel",defaultMessage:"Cancel"})}),i==="create"?e.jsx(R,{type:"submit",loading:a,children:r(S)}):e.jsx(R,{type:"button",loading:a,onClick:t,children:r(S)})]})]})})]})}):null},W={firstname:"",lastname:"",email:"",roles:[]},Pe=[],Ue=[[{label:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"string",size:6,required:!0},{label:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"string",size:6}],[{label:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:6,required:!0}]],ve=de().shape({firstname:q().trim().required({id:j.required.id,defaultMessage:"This field is required"}).nullable(),lastname:q(),email:q().email(j.email).required({id:j.required.id,defaultMessage:"This field is required"}).nullable(),roles:ue().min(1,{id:j.required.id,defaultMessage:"This field is required"}).required({id:j.required.id,defaultMessage:"This field is required"})}),we={create:{buttonSubmitLabel:{id:"app.containers.Users.ModalForm.footer.button-success",defaultMessage:"Invite user"},isDisabled:!1,next:"magic-link"},"magic-link":{buttonSubmitLabel:{id:"global.finish",defaultMessage:"Finish"},isDisabled:!0,next:null}},ke=()=>{const{_unstableFormatAPIError:t}=G(),[i,p]=g.useState(!1),v=J(s=>s.admin_app.permissions),{allowedActions:{canCreate:w,canDelete:r,canRead:m}}=ge(v.settings?.users),k=pe(),{toggleNotification:_}=Z(),{formatMessage:d}=B(),{search:D}=he(),[L,h]=g.useState(!1),[y,O]=g.useState([]),{data:F,isError:S,isLoading:x}=xe(be.parse(D,{ignoreQueryPrefix:!0})),{user:C}=fe("ListPageCE",s=>s),{pagination:a,users:c=[]}=F??{},l=E(Te,async()=>(await M(async()=>{const{CreateActionEE:s}=await import("./CreateActionEE-CGsUSBjE.js");return{CreateActionEE:s}},__vite__mapDeps([5,1,2,6]))).CreateActionEE),n=De.map(s=>({...s,label:d(s.label)})),H=d({id:"global.users",defaultMessage:"Users"}),Y=()=>{p(s=>!s)},[X]=je(),ee=async s=>{try{const u=await X({ids:s});"error"in u&&_({type:"danger",message:t(u.error)})}catch{_({type:"danger",message:d({id:"global.error",defaultMessage:"An error occurred"})})}},se=s=>()=>{m&&k(s.toString())},te=s=>async()=>{O([s]),h(!0)},ae=async()=>{await ee(y),h(!1)};return l?S?e.jsx(P.Error,{}):e.jsxs(P.Main,{"aria-busy":x,children:[e.jsx(P.Title,{children:d({id:"Settings.PageTitle",defaultMessage:"Settings - {name}"},{name:"Users"})}),e.jsx(z.Header,{primaryAction:w&&e.jsx(l,{onClick:Y}),title:H,subtitle:d({id:"Settings.permissions.users.listview.header.subtitle",defaultMessage:"All the users who have access to the Strapi admin panel"})}),e.jsx(z.Action,{startActions:e.jsxs(e.Fragment,{children:[e.jsx(Se,{label:d({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:H})}),e.jsxs(T.Root,{options:Oe,children:[e.jsx(T.Trigger,{}),e.jsx(T.Popover,{zIndex:499}),e.jsx(T.List,{})]})]})}),e.jsxs(z.Content,{children:[e.jsxs(o.Root,{rows:c,headers:n,children:[e.jsx(o.ActionBar,{}),e.jsxs(o.Content,{children:[e.jsxs(o.Head,{children:[r?e.jsx(o.HeaderCheckboxCell,{}):null,n.map(s=>e.jsx(o.HeaderCell,{...s},s.name))]}),e.jsx(o.Empty,{}),e.jsx(o.Loading,{}),e.jsx(o.Body,{children:c.map(s=>e.jsxs(o.Row,{onClick:se(s.id),cursor:m?"pointer":"default",children:[r?e.jsx(o.CheckboxCell,{id:s.id}):null,n.map(({cellFormatter:u,name:V,...re})=>e.jsx(o.Cell,{children:typeof u=="function"?u(s,{name:V,...re}):e.jsx(A,{textColor:"neutral800",children:s[V]||"-"})},V)),m||r?e.jsx(o.Cell,{onClick:u=>u.stopPropagation(),children:e.jsxs(U,{justifyContent:"end",children:[m?e.jsx($,{tag:Ee,to:s.id.toString(),label:d({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:K(s)}),variant:"ghost",children:e.jsx(Me,{})}):null,r&&C?.id!==s.id?e.jsx($,{onClick:te(s.id),label:d({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:K(s)}),variant:"ghost",children:e.jsx(Ae,{})}):null]})}):null]},s.id))})]})]}),e.jsxs(N.Root,{...a,children:[e.jsx(N.PageSize,{}),e.jsx(N.Links,{})]})]}),i&&e.jsx(Re,{onToggle:Y}),e.jsx(_e.Root,{open:L,onOpenChange:h,children:e.jsx(Le,{onConfirm:ae})})]}):null},De=[{name:"firstname",label:{id:"Settings.permissions.users.firstname",defaultMessage:"Firstname"},sortable:!0},{name:"lastname",label:{id:"Settings.permissions.users.lastname",defaultMessage:"Lastname"},sortable:!0},{name:"email",label:{id:"Settings.permissions.users.email",defaultMessage:"Email"},sortable:!0},{name:"roles",label:{id:"Settings.permissions.users.roles",defaultMessage:"Roles"},sortable:!1,cellFormatter({roles:t}){return e.jsx(A,{textColor:"neutral800",children:t.map(i=>i.name).join(`,
`)})}},{name:"username",label:{id:"Settings.permissions.users.username",defaultMessage:"Username"},sortable:!0},{name:"isActive",label:{id:"Settings.permissions.users.user-status",defaultMessage:"User status"},sortable:!1,cellFormatter({isActive:t}){return e.jsx(U,{children:e.jsx(ye,{size:"S",variant:t?"success":"danger",children:e.jsx(A,{tag:"span",variant:"omega",fontWeight:"bold",children:t?"Active":"Inactive"})})})}}],Oe=[{name:"firstname",label:"Firstname",type:"string"},{name:"lastname",label:"Lastname",type:"string"},{name:"email",label:"Email",type:"email"},{name:"username",label:"Username",type:"string"},{name:"isActive",label:"Active user",type:"boolean"}],Fe=()=>{const t=E(ke,async()=>(await M(async()=>{const{UserListPageEE:i}=await import("./ListPage-CZ4CK6WJ.js");return{UserListPageEE:i}},__vite__mapDeps([7,1,2,8,6,9,10,3,4]))).UserListPageEE);return t?e.jsx(t,{}):null},He=()=>{const t=J(i=>i.admin_app.permissions.settings?.users.read);return e.jsx(P.Protect,{permissions:t,children:e.jsx(Fe,{})})};export{Fe as ListPage,ke as ListPageCE,He as ProtectedListPage};
