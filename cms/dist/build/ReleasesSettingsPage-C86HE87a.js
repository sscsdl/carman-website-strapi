import{j as e,P as d,a as T,p as R,q as A,s as w,v as C,w as S,x as z,F as L,L as x,G as E,z as F,y as D,T as H,I as U,U as j,A as B,B as G,H as l,D as _,E as N}from"./strapi-D0ivxu6x.js";import{u as m}from"./hooks-DIoN5XwE.js";import{S as V}from"./schemas-Blgsjo6g.js";const W=()=>{const{formatMessage:s}=T(),{formatAPIError:o}=R(),{toggleNotification:i}=A(),{data:c,isLoading:a}=w(),[t,{isLoading:v}]=C(),y=m(r=>r.admin_app.permissions.settings?.releases),{allowedActions:{canUpdate:M}}=S(y),{timezoneList:b}=z(new Date),P=async(r,{setErrors:u})=>{const{defaultTimezone:g}=r,f=g,h=b.some(n=>n.value===f);if(!h&&g){const n=s({id:"components.Input.error.validation.combobox.invalid",defaultMessage:"The value provided is not valid"});u({defaultTimezone:n}),i({type:"danger",message:n});return}const I=!g||!h?{defaultTimezone:null}:{defaultTimezone:f};try{const n=await t(I);"data"in n?i({type:"success",message:s({id:"content-releases.pages.Settings.releases.setting.default-timezone-notification-success",defaultMessage:"Default timezone updated."})}):B(n.error)?i({type:"danger",message:o(n.error)}):i({type:"danger",message:s({id:"notification.error",defaultMessage:"An error occurred"})})}catch{i({type:"danger",message:s({id:"notification.error",defaultMessage:"An error occurred"})})}};if(a)return e.jsx(d.Loading,{});const p=s({id:"content-releases.pages.Releases.title",defaultMessage:"Releases"});return e.jsxs(e.Fragment,{children:[e.jsx(d.Title,{children:s({id:"Settings.PageTitle",defaultMessage:"Settings - {name}"},{name:p})}),e.jsx(d.Main,{"aria-busy":a,tabIndex:-1,children:e.jsx(L,{method:"PUT",initialValues:{defaultTimezone:c?.data.defaultTimezone},onSubmit:P,validationSchema:V,children:({modified:r,isSubmitting:u})=>e.jsxs(e.Fragment,{children:[e.jsx(x.Header,{primaryAction:M?e.jsx(F,{disabled:!r||v,loading:u,startIcon:e.jsx(D,{}),type:"submit",fullWidth:!0,children:s({id:"global.save",defaultMessage:"Save"})}):null,secondaryAction:e.jsx(E,{label:s({id:"components.premiumFeature.title",defaultMessage:"Premium feature"})}),title:p,subtitle:s({id:"content-releases.pages.Settings.releases.description",defaultMessage:"Create and manage content updates"})}),e.jsx(x.Content,{children:e.jsxs(H,{direction:"column",background:"neutral0",alignItems:"stretch",padding:6,gap:6,shadow:"filterShadow",hasRadius:!0,children:[e.jsx(U,{variant:"delta",tag:"h2",children:s({id:"content-releases.pages.Settings.releases.preferences.title",defaultMessage:"Preferences"})}),e.jsx(j.Root,{children:e.jsx(j.Item,{col:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(k,{})})})]})})]})})})]})},k=()=>{const s=m(t=>t.admin_app.permissions.settings?.releases),{allowedActions:{canUpdate:o}}=S(s),{formatMessage:i}=T(),{timezoneList:c}=z(new Date),a=G("defaultTimezone");return e.jsxs(l.Root,{name:"defaultTimezone",hint:i({id:"content-releases.pages.Settings.releases.timezone.hint",defaultMessage:"The timezone of every release can still be changed individually."}),error:a.error,children:[e.jsx(l.Label,{children:i({id:"content-releases.pages.Settings.releases.timezone.label",defaultMessage:"Default timezone"})}),e.jsx(_,{autocomplete:{type:"list",filter:"contains"},onTextValueChange:t=>a.onChange("defaultTimezone",t),onChange:t=>{(a.value&&t||!a.value)&&a.onChange("defaultTimezone",t)},onClear:()=>a.onChange("defaultTimezone",""),value:a.value,disabled:!o,children:c.map(t=>e.jsx(N,{value:t.value,children:t.value.replace(/&/," ")},t.value))}),e.jsx(l.Hint,{}),e.jsx(l.Error,{})]})},K=()=>{const s=m(o=>o.admin_app.permissions.settings?.releases?.read);return e.jsx(d.Protect,{permissions:s,children:e.jsx(W,{})})};export{K as ProtectedReleasesSettingsPage};
