import{cd as e,b2 as T,b3 as d,b4 as A,bg as R,a as L,q as I,a$ as P,ce as z,c9 as N,p as U,w as C,cf as p,cg as q,ch as H,j as a,P as o,F as O,L as u,z as $,y as k,Z as D,T as Q,I as W,U as m,b7 as B}from"./strapi-D0ivxu6x.js";import"./_getTag-ryJ-JVfa.js";const G=[{label:{id:e("EditForm.inputToggle.label.email"),defaultMessage:"One account per email address"},hint:{id:e("EditForm.inputToggle.description.email"),defaultMessage:"Disallow the user to create multiple accounts using the same email address with different authentication providers."},name:"unique_email",type:"boolean",size:12},{label:{id:e("EditForm.inputToggle.label.sign-up"),defaultMessage:"Enable sign-ups"},hint:{id:e("EditForm.inputToggle.description.sign-up"),defaultMessage:"When disabled (OFF), the registration process is forbidden. No one can subscribe anymore no matter the used provider."},name:"allow_register",type:"boolean",size:12},{label:{id:e("EditForm.inputToggle.label.email-reset-password"),defaultMessage:"Reset password page"},hint:{id:e("EditForm.inputToggle.description.email-reset-password"),defaultMessage:"URL of your application's reset password page."},placeholder:{id:e("EditForm.inputToggle.placeholder.email-reset-password"),defaultMessage:"ex: https://youtfrontend.com/reset-password"},name:"email_reset_password",type:"string",size:12},{label:{id:e("EditForm.inputToggle.label.email-confirmation"),defaultMessage:"Enable email confirmation"},hint:{id:e("EditForm.inputToggle.description.email-confirmation"),defaultMessage:"When enabled (ON), new registered users receive a confirmation email."},name:"email_confirmation",type:"boolean",size:12},{label:{id:e("EditForm.inputToggle.label.email-confirmation-redirection"),defaultMessage:"Redirection url"},hint:{id:e("EditForm.inputToggle.description.email-confirmation-redirection"),defaultMessage:"After you confirmed your email, choose where you will be redirected."},placeholder:{id:e("EditForm.inputToggle.placeholder.email-confirmation-redirection"),defaultMessage:"ex: https://youtfrontend.com/email-confirmation"},name:"email_confirmation_redirection",type:"string",size:12}],g=new RegExp("(^$)|((.+:\\/\\/.*)(d*)\\/?(.*))"),V=T().shape({email_confirmation_redirection:R().when("email_confirmation",{is:!0,then:d().matches(g).required(),otherwise:d().nullable()}),email_reset_password:d().matches(g,{id:A.regex.id,defaultMessage:"This is not a valid URL"}).nullable()}),K=()=>a.jsx(o.Protect,{permissions:p.readAdvancedSettings,children:a.jsx(X,{})}),X=()=>{const{formatMessage:t}=L(),{toggleNotification:r}=I(),{notifyStatus:h}=P(),f=z(),{get:b,put:v}=N(),{formatAPIError:M}=U(),{isLoading:y,allowedActions:{canUpdate:S}}=C({update:p.updateAdvancedSettings}),{isLoading:w,data:l}=q(["users-permissions","advanced"],async()=>{const{data:i}=await b("/users-permissions/advanced");return i},{onSuccess(){h(t({id:e("Form.advancedSettings.data.loaded"),defaultMessage:"Advanced settings data has been loaded"}))},onError(){r({type:"danger",message:t({id:e("notification.error"),defaultMessage:"An error occured"})})}}),E=y||w,c=H(i=>v("/users-permissions/advanced",i),{async onSuccess(){await f.invalidateQueries(["users-permissions","advanced"]),r({type:"success",message:t({id:e("notification.success.saved"),defaultMessage:"Saved"})})},onError(i){r({type:"danger",message:M(i)})},refetchActive:!0}),{isLoading:x}=c,F=async i=>{c.mutate({...i,email_confirmation_redirection:i.email_confirmation?i.email_confirmation_redirection:""})};return E?a.jsx(o.Loading,{}):a.jsxs(o.Main,{"aria-busy":x,children:[a.jsx(o.Title,{children:t({id:"Settings.PageTitle",defaultMessage:"Settings - {name}"},{name:t({id:e("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})})}),a.jsx(O,{onSubmit:F,initialValues:l.settings,validationSchema:V,children:({values:i,isSubmitting:_,modified:j})=>a.jsxs(a.Fragment,{children:[a.jsx(u.Header,{title:t({id:e("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"}),primaryAction:a.jsx($,{loading:_,type:"submit",disabled:!j||!S,startIcon:a.jsx(k,{}),size:"S",fullWidth:!0,children:t({id:"global.save",defaultMessage:"Save"})})}),a.jsx(u.Content,{children:a.jsx(D,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:a.jsxs(Q,{direction:"column",alignItems:"stretch",gap:4,children:[a.jsx(W,{variant:"delta",tag:"h2",children:t({id:"global.settings",defaultMessage:"Settings"})}),a.jsx(m.Root,{gap:6,children:[{label:{id:e("EditForm.inputSelect.label.role"),defaultMessage:"Default role for authenticated users"},hint:{id:e("EditForm.inputSelect.description.role"),defaultMessage:"It will attach the new authenticated user to the selected role."},options:l.roles.map(n=>({label:n.name,value:n.type})),name:"default_role",size:6,type:"enumeration"},...G].map(({size:n,...s})=>a.jsx(m.Item,{col:n,direction:"column",alignItems:"stretch",children:a.jsx(B,{...s,disabled:s.name==="email_confirmation_redirection"&&i.email_confirmation===!1,label:t(s.label),hint:s.hint?t(s.hint):void 0,placeholder:s.placeholder?t(s.placeholder):void 0})},s.name))})]})})})]})})]})};export{X as AdvancedSettingsPage,K as ProtectedAdvancedSettingsPage};
