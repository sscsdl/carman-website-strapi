import{c9 as w,q as R,a as v,ce as K,r as b,cg as G,cM as s,cb as X,cN as Z,j as e,P as y,cO as Y,cP as V,cQ as $,cR as ee,cS as te,ch as L,L as D,z as ae,y as P,T as o,Z as O,U as f,cT as se,I as h,H as r,cK as M,bo as ie,cC as ne,bK as T,aZ as oe,bL as re}from"./strapi-D0ivxu6x.js";const le=async t=>{try{const{data:i}=await t("/upload/actions/generate-ai-metadata/latest");return i}catch{return null}},de=t=>{const{get:i}=w(),{toggleNotification:n}=R(),{formatMessage:u}=v(),p=K(),l=t?.enabled??!0,[c,C]=b.useState(null),{data:x,refetch:g}=G(["ai-metadata-latest-job"],()=>le(i),{enabled:l,refetchInterval:m=>m&&m.status==="processing"?1e3:!1,retry:!1,refetchOnWindowFocus:!1}),d=x?.status??null;return b.useEffect(()=>{d&&(c==="processing"&&d==="completed"&&(n({type:"success",message:u({id:s("settings.form.aiMetadata.job-completed"),defaultMessage:"Successfully generated metadata"})}),p.invalidateQueries(["ai-metadata-count"])),c==="processing"&&d==="failed"&&n({type:"danger",message:u({id:s("settings.form.aiMetadata.job-failed"),defaultMessage:"Failed to generate metadata. Please try again."})}),c!==d&&C(d))},[d,c,n,u,p]),{data:x,refetch:g}},ce=t=>t,z={responsiveDimensions:!0,sizeOptimization:!0,autoOrientation:!1,videoPreview:!1,aiMetadata:!0},ge={initialData:z,modifiedData:{...z}},ue=(t,i)=>X(t,n=>{switch(i.type){case"GET_DATA_SUCCEEDED":{n.initialData=i.data,n.modifiedData=i.data;break}case"ON_CHANGE":{Z(n,["modifiedData",...i.keys.split(".")],i.value);break}default:return t}}),H=t=>{const{formatMessage:i}=v();return e.jsx(ne,{size:"S",variant:"secondary",style:{textTransform:"uppercase",display:"flex"},...t,children:e.jsx(h,{tag:"span",variant:"pi",fontWeight:"bold",children:i({id:"app.components.Status.beta",defaultMessage:"Beta"})})})},me=({job:t,imagesWithoutMetadataCount:i,isConfirmDialogOpen:n,onConfirmDialogChange:u,onGenerate:p})=>{const{formatMessage:l}=v();return t?.status==="processing"?e.jsx(o,{gap:2,alignItems:"center",children:e.jsx(h,{variant:"pi",textColor:"neutral600",children:l({id:s("settings.form.aiMetadata.generatingMetadata"),defaultMessage:"AI is generating your metadata"})})}):i===0?e.jsx(h,{variant:"pi",textColor:"primary600",children:e.jsxs(o,{gap:2,alignItems:"center",children:[e.jsx(P,{width:"16px",height:"16px"}),l({id:s("settings.form.aiMetadata.metadataGenerated"),defaultMessage:"Your metadata has been generated"})]})}):e.jsxs(T.Root,{open:n,onOpenChange:u,children:[e.jsx(T.Trigger,{children:e.jsx(oe,{disabled:i===0,children:l({id:s("settings.form.aiMetadata.generateButton"),defaultMessage:"Generate metadata"})})}),e.jsx(re,{variant:"success-light",onConfirm:p,title:e.jsxs(o,{gap:2,children:[e.jsx(H,{}),l({id:s("settings.form.aiMetadata.confirmDialog.title"),defaultMessage:"Generate AI Metadata"})]}),children:l({id:s("settings.form.aiMetadata.confirmDialog.message"),defaultMessage:"This will start a process in the background to generate captions and alternative text for {count, plural, one {# image} other {# images}}. AI can make mistakes, be sure to review the generated content."},{count:i})})]})},fe=()=>{const{formatMessage:t}=v(),{toggleNotification:i}=R(),{put:n,post:u,get:p}=w(),[l,c]=b.useState(!1),{trackUsage:C}=V(),[{initialData:x,modifiedData:g},d]=b.useReducer(ue,ge,ce),{data:m,isLoading:N,refetch:J}=$(),I=ee(),{data:A,isLoading:_}=G(["ai-metadata-count"],async()=>{const{data:a}=await p("/upload/actions/generate-ai-metadata/count");return a},{enabled:I&&!!m?.aiMetadata,retry:!1}),S=A?.imagesWithoutMetadataCount??0;b.useEffect(()=>{m&&d({type:"GET_DATA_SUCCEEDED",data:m})},[m]);const E=te(x,g),{mutateAsync:B,isLoading:W}=L(async a=>{const{data:k}=await n("/upload/settings",a);return k},{onSuccess(){J(),i({type:"success",message:t({id:"notification.form.success.fields"})})},onError(a){i({type:"danger",message:a.message||t({id:"notification.error"})})}}),{data:F,refetch:U}=de({enabled:I}),{mutateAsync:q}=L(async()=>{const{data:a}=await u("/upload/actions/generate-ai-metadata",{});return a},{onSuccess(){c(!1),U()},onError(a){i({type:"danger",message:a?.message||t({id:"notification.error"})}),c(!1)}}),Q=async a=>{a.preventDefault(),!E&&await B(g)},j=({target:{name:a,value:k}})=>{d({type:"ON_CHANGE",keys:a,value:k})};return N?e.jsx(y.Loading,{}):e.jsxs(y.Main,{tabIndex:-1,children:[e.jsx(y.Title,{children:t({id:s("page.title"),defaultMessage:"Settings - Media Library"})}),e.jsxs("form",{onSubmit:Q,children:[e.jsx(D.Header,{title:t({id:s("settings.header.label"),defaultMessage:"Media Library"}),primaryAction:e.jsx(ae,{disabled:E,loading:W,type:"submit",startIcon:e.jsx(P,{}),size:"S",fullWidth:!0,children:t({id:"global.save",defaultMessage:"Save"})}),subtitle:t({id:s("settings.sub-header.label"),defaultMessage:"Configure the settings for the Media Library"})}),e.jsx(D.Content,{children:e.jsx(D.Root,{children:e.jsxs(o,{direction:"column",alignItems:"stretch",gap:4,children:[I&&e.jsx(O,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:e.jsxs(o,{direction:"column",alignItems:"stretch",gap:1,children:[e.jsxs(f.Root,{gap:6,children:[e.jsxs(f.Item,{col:8,xs:12,direction:"column",alignItems:"stretch",children:[e.jsxs(o,{gap:2,children:[e.jsx(O,{color:"alternative700",children:e.jsx(se,{})}),e.jsx(h,{variant:"delta",tag:"h2",children:t({id:s("settings.form.aiMetadata.label"),defaultMessage:"Generate AI captions and alt texts automatically on upload!"})})]}),e.jsx(o,{paddingTop:1,children:e.jsx(h,{variant:"pi",textColor:"neutral600",children:t({id:s("settings.form.aiMetadata.description"),defaultMessage:"Enable this feature to save time, optimize your SEO and increase accessibility by letting our AI generate captions and alternative texts for you."})})})]}),e.jsx(f.Item,{col:4,xs:12,direction:"column",alignItems:"end",justifyContent:"center",children:e.jsx(r.Root,{name:"aiMetadata",minWidth:"200px",children:e.jsx(M,{checked:g?.aiMetadata,offLabel:t({id:"app.components.ToggleCheckbox.disabled-label",defaultMessage:"Disabled"}),onLabel:t({id:"app.components.ToggleCheckbox.enabled-label",defaultMessage:"Enabled"}),onChange:a=>{j({target:{name:"aiMetadata",value:a.target.checked}})}})})})]}),x?.aiMetadata&&!_&&!!A?.totalImages&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{marginTop:4,marginBottom:4}),e.jsxs(o,{justifyContent:"space-between",alignItems:"center",gap:2,children:[e.jsxs(o,{gap:2,children:[e.jsx(H,{size:"XS"}),e.jsx(h,{variant:"pi",textColor:"neutral500",children:S===0?t({id:s("settings.form.aiMetadata.allAssetsHaveMetadata"),defaultMessage:"All assets have caption and alt text"}):t({id:s("settings.form.aiMetadata.imagesWithoutMetadata"),defaultMessage:"{count, plural, one {# image lacks captions or alternative text} other {# images lack captions or alternative text}}"},{count:S})})]}),e.jsx(me,{job:F??null,imagesWithoutMetadataCount:S,isConfirmDialogOpen:l,onConfirmDialogChange:c,onGenerate:async()=>{await q(),C("didGenerateMetadataRetroactively")}})]})]})]})}),e.jsx(O,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:e.jsxs(o,{direction:"column",alignItems:"stretch",gap:4,children:[e.jsx(o,{children:e.jsx(h,{variant:"delta",tag:"h2",children:t({id:s("settings.blockTitle"),defaultMessage:"Asset management"})})}),e.jsxs(f.Root,{gap:6,children:[e.jsx(f.Item,{col:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsxs(r.Root,{hint:t({id:s("settings.form.responsiveDimensions.description"),defaultMessage:"Enabling this option will generate multiple formats (small, medium and large) of the uploaded asset."}),name:"responsiveDimensions",children:[e.jsx(r.Label,{children:t({id:s("settings.form.responsiveDimensions.label"),defaultMessage:"Responsive friendly upload"})}),e.jsx(M,{checked:g?.responsiveDimensions,offLabel:t({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:t({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:a=>{j({target:{name:"responsiveDimensions",value:a.target.checked}})}}),e.jsx(r.Hint,{})]})}),e.jsx(f.Item,{col:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsxs(r.Root,{hint:t({id:s("settings.form.sizeOptimization.description"),defaultMessage:"Enabling this option will reduce the image size and slightly reduce its quality."}),name:"sizeOptimization",children:[e.jsx(r.Label,{children:t({id:s("settings.form.sizeOptimization.label"),defaultMessage:"Size optimization"})}),e.jsx(M,{checked:g?.sizeOptimization,offLabel:t({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:t({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:a=>{j({target:{name:"sizeOptimization",value:a.target.checked}})}}),e.jsx(r.Hint,{})]})}),e.jsx(f.Item,{col:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsxs(r.Root,{hint:t({id:s("settings.form.autoOrientation.description"),defaultMessage:"Enabling this option will automatically rotate the image according to EXIF orientation tag."}),name:"autoOrientation",children:[e.jsx(r.Label,{children:t({id:s("settings.form.autoOrientation.label"),defaultMessage:"Auto orientation"})}),e.jsx(M,{checked:g?.autoOrientation,offLabel:t({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:t({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:a=>{j({target:{name:"autoOrientation",value:a.target.checked}})}}),e.jsx(r.Hint,{})]})})]})]})})]})})})]})]})},pe=()=>e.jsx(y.Protect,{permissions:Y.settings,children:e.jsx(fe,{})});export{pe as ProtectedSettingsPage,fe as SettingsPage};
