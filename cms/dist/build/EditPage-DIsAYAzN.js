const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["EventsTable-DQ9B4tlC.js","strapi-D0ivxu6x.js","strapi-D6821bIJ.css","selectors-MEKBT33G.js","useWebhooks-8ByQGsa8.js"])))=>i.map(i=>d[i]);
import{a as j,j as e,T as g,H as S,eC as Y,eD as W,eE as I,bH as ee,I as x,B as C,eF as te,l as V,eG as A,bG as $,eH as se,cq as R,Z as w,U as f,eI as re,o as ne,eJ as ae,aI as ie,r as k,D as oe,E as le,aZ as de,C as D,cF as ce,y as N,bz as ue,M as he,F as ge,L as F,bx as me,z as _,eK as pe,b7 as be,b2 as q,bf as z,eL as fe,b3 as E,aJ as xe,Q as je,q as ke,p as ye,P as H,aT as we,a_ as Se,b6 as L}from"./strapi-D0ivxu6x.js";import{s as ve}from"./selectors-MEKBT33G.js";import{u as Ee}from"./useWebhooks-8ByQGsa8.js";const Ce=({children:t})=>{const{formatMessage:s}=j(),r=s({id:"Settings.webhooks.form.events",defaultMessage:"Events"});return e.jsxs(g,{direction:"column",alignItems:"stretch",gap:1,children:[e.jsx(S.Label,{"aria-hidden":!0,children:r}),e.jsx(Me,{"aria-label":r,children:t})]})},Me=V(se)`
  tbody tr:nth-child(odd) {
    background: ${({theme:t})=>t.colors.neutral100};
  }

  thead th span {
    color: ${({theme:t})=>t.colors.neutral500};
  }

  td,
  th {
    padding-block-start: ${({theme:t})=>t.spaces[3]};
    padding-block-end: ${({theme:t})=>t.spaces[3]};
    width: 6%;
    vertical-align: middle;
  }

  tbody tr td:first-child {
    /**
     * Add padding to the start of the first column to avoid the checkbox appearing
     * too close to the edge of the table
     */
    padding-inline-start: ${({theme:t})=>t.spaces[2]};
  }
`,Ie=()=>[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"},{id:"app.utils.publish",defaultMessage:"Publish"},{id:"app.utils.unpublish",defaultMessage:"Unpublish"}],Ae=({getHeaders:t=Ie})=>{const{formatMessage:s}=j(),r=t();return e.jsx(Y,{children:e.jsxs(W,{children:[e.jsx(I,{children:e.jsx(ee,{children:s({id:"Settings.webhooks.event.select",defaultMessage:"Select event"})})}),r.map(a=>["app.utils.publish","app.utils.unpublish"].includes(a?.id??"")?e.jsx(I,{title:s({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"}),children:e.jsx(x,{variant:"sigma",textColor:"neutral600",children:s(a)})},a.id):e.jsx(I,{children:e.jsx(x,{variant:"sigma",textColor:"neutral600",children:s(a)})},a.id))]})})},Re=({providedEvents:t})=>{const s=t||Te(),{value:r=[],onChange:a}=C("events"),h="events",i=r,n=[],u=i.reduce((l,d)=>{const o=d.split(".")[0];return l[o]||(l[o]=[]),l[o].push(d),l},{}),b=(l,d)=>{const o=new Set(i);d?o.add(l):o.delete(l),a(h,Array.from(o))},c=(l,d)=>{const o=new Set(i);d?s[l].forEach(m=>{n.includes(m)||o.add(m)}):s[l].forEach(m=>o.delete(m)),a(h,Array.from(o))};return e.jsx(te,{children:Object.entries(s).map(([l,d])=>e.jsx(He,{disabledEvents:n,name:l,events:d,inputValue:u[l],handleSelect:b,handleSelectAll:c},l))})},Te=()=>({entry:["entry.create","entry.update","entry.delete","entry.publish","entry.unpublish"],media:["media.create","media.update","media.delete"]}),He=({disabledEvents:t=[],name:s,events:r=[],inputValue:a=[],handleSelect:h,handleSelectAll:i})=>{const{formatMessage:n}=j(),u=r.filter(o=>!t.includes(o)),b=a.length>0,c=a.length===u.length,l=()=>{i(s,!c)},d=5;return e.jsxs(W,{children:[e.jsx(A,{children:e.jsx($,{"aria-label":n({id:"global.select-all-entries",defaultMessage:"Select all entries"}),name:s,checked:b&&!c?"indeterminate":c,onCheckedChange:l,children:Pe(s)})}),r.map(o=>e.jsx(A,{textAlign:"center",children:e.jsx(g,{width:"100%",justifyContent:"center",children:e.jsx($,{disabled:t.includes(o),"aria-label":o,name:o,checked:a.includes(o),onCheckedChange:m=>h(o,!!m)})})},o)),r.length<d&&e.jsx(A,{colSpan:d-r.length})]})},Pe=t=>t.replace(/-/g," ").split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()).join(" "),T={Root:Ce,Headers:Ae,Body:Re},$e=()=>e.jsxs(T.Root,{children:[e.jsx(T.Headers,{}),e.jsx(T.Body,{})]}),Fe=V(de)`
  cursor: pointer;
`,_e=()=>{const{formatMessage:t}=j(),s=R("HeadersInput",n=>n.addFieldRow),r=R("HeadersInput",n=>n.removeFieldRow),a=R("HeadersInput",n=>n.onChange),{value:h=[]}=C("headers"),i=n=>{h.length===1?a("headers",[{key:"",value:""}]):r("headers",n)};return e.jsxs(g,{direction:"column",alignItems:"stretch",gap:1,children:[e.jsx(S.Label,{children:t({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})}),e.jsxs(w,{padding:8,background:"neutral100",hasRadius:!0,children:[h.map((n,u)=>e.jsxs(f.Root,{gap:4,padding:2,children:[e.jsx(f.Item,{xs:12,col:6,direction:"column",alignItems:"stretch",children:e.jsx(qe,{name:`headers.${u}.key`,"aria-label":`row ${u+1} key`,label:t({id:"Settings.webhooks.key",defaultMessage:"Key"})})}),e.jsx(f.Item,{xs:12,col:6,direction:"column",alignItems:"stretch",children:e.jsxs(g,{alignItems:"flex-end",gap:2,children:[e.jsx(w,{style:{flex:1},children:e.jsx(re,{name:`headers.${u}.value`,"aria-label":`row ${u+1} value`,label:t({id:"Settings.webhooks.value",defaultMessage:"Value"}),type:"text"})}),e.jsx(ne,{width:"4rem",height:"4rem",onClick:()=>i(u),color:"primary600",label:t({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:u+1}),type:"button",children:e.jsx(ae,{width:"0.8rem"})})]})})]},`${u}-${JSON.stringify(n.key)}`)),e.jsx(w,{paddingTop:4,children:e.jsx(Fe,{type:"button",onClick:()=>{s("headers",{key:"",value:""})},startIcon:e.jsx(ie,{}),children:t({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"})})})]})]})},qe=({name:t,label:s,...r})=>{const[a,h]=k.useState([...O]),{value:i}=C("headers"),n=C(t);k.useEffect(()=>{const c=O.filter(l=>!i?.some(d=>d.key!==n.value&&d.key===l));h(c)},[i,n.value]);const u=c=>{n.onChange(t,c)},b=c=>{h(l=>[...l,c]),c&&u(c)};return e.jsxs(S.Root,{name:t,error:n.error,children:[e.jsx(S.Label,{children:s}),e.jsx(oe,{...r,onClear:()=>u(""),onChange:u,onCreateOption:b,placeholder:"",creatable:!0,value:n.value,children:a.map(c=>e.jsx(le,{value:c,children:c},c))}),e.jsx(S.Error,{})]})},O=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],ze=({isPending:t,onCancel:s,response:r})=>{const{statusCode:a,message:h}=r??{},{formatMessage:i}=j();return e.jsx(w,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0,children:e.jsxs(f.Root,{gap:4,style:{alignItems:"center"},children:[e.jsx(f.Item,{col:3,direction:"column",alignItems:"stretch",children:e.jsx(x,{children:i({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"})})}),e.jsx(f.Item,{col:3,direction:"column",alignItems:"stretch",children:e.jsx(Le,{isPending:t,statusCode:a})}),e.jsx(f.Item,{col:6,direction:"column",alignItems:"stretch",children:t?e.jsx(g,{justifyContent:"flex-end",children:e.jsx("button",{onClick:s,type:"button",children:e.jsxs(g,{gap:2,alignItems:"center",children:[e.jsx(x,{textColor:"neutral400",children:i({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})}),e.jsx(D,{fill:"neutral400",height:"1.2rem",width:"1.2rem"})]})})}):e.jsx(Oe,{statusCode:a,message:h})})]})})},Le=({isPending:t,statusCode:s})=>{const{formatMessage:r}=j();return t||!s?e.jsxs(g,{gap:2,alignItems:"center",children:[e.jsx(ce,{height:"1.2rem",width:"1.2rem"}),e.jsx(x,{children:r({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"})})]}):s>=200&&s<300?e.jsxs(g,{gap:2,alignItems:"center",children:[e.jsx(N,{fill:"success700",height:"1.2rem",width:"1.2rem"}),e.jsx(x,{children:r({id:"Settings.webhooks.trigger.success",defaultMessage:"success"})})]}):s>=300?e.jsxs(g,{gap:2,alignItems:"center",children:[e.jsx(D,{fill:"danger700",height:"1.2rem",width:"1.2rem"}),e.jsxs(x,{children:[r({id:"Settings.error",defaultMessage:"error"})," ",s]})]}):null},Oe=({statusCode:t,message:s})=>{const{formatMessage:r}=j();return t?t>=200&&t<300?e.jsx(g,{justifyContent:"flex-end",children:e.jsx(x,{textColor:"neutral600",ellipsis:!0,children:r({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"})})}):t>=300?e.jsx(g,{justifyContent:"flex-end",children:e.jsx(g,{maxWidth:"25rem",justifyContent:"flex-end",title:s,children:e.jsx(x,{ellipsis:!0,textColor:"neutral600",children:s})})}):null:null},Ue=({handleSubmit:t,triggerWebhook:s,isCreating:r,isTriggering:a,triggerResponse:h,data:i})=>{const{formatMessage:n}=j(),[u,b]=k.useState(!1),c=ue($e,async()=>(await he(async()=>{const{EventsTableEE:d}=await import("./EventsTable-DQ9B4tlC.js");return{EventsTableEE:d}},__vite__mapDeps([0,1,2,3,4]))).EventsTableEE),l=d=>Object.keys(d).length?Object.entries(d).map(([o,m])=>({key:o,value:m})):[{key:"",value:""}];return c?e.jsx(ge,{initialValues:{name:i?.name||"",url:i?.url||"",headers:l(i?.headers||{}),events:i?.events||[]},method:r?"POST":"PUT",onSubmit:t,validationSchema:De({formatMessage:n}),children:({isSubmitting:d,modified:o})=>e.jsxs(e.Fragment,{children:[e.jsx(F.Header,{primaryAction:e.jsxs(g,{width:"100%",gap:2,children:[e.jsx(_,{onClick:()=>{s(),b(!0)},variant:"tertiary",startIcon:e.jsx(pe,{}),disabled:r||a,fullWidth:!0,children:n({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})}),e.jsx(_,{startIcon:e.jsx(N,{}),type:"submit",disabled:!o,loading:d,fullWidth:!0,children:n({id:"global.save",defaultMessage:"Save"})})]}),title:r?n({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):i?.name,navigationAction:e.jsx(w,{display:{initial:"none",medium:"block"},children:e.jsx(me,{fallback:"../webhooks"})})}),e.jsx(F.Content,{children:e.jsxs(g,{direction:"column",alignItems:"stretch",gap:4,children:[u&&e.jsx(ze,{isPending:a,response:h,onCancel:()=>b(!1)}),e.jsx(w,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0,children:e.jsxs(g,{direction:"column",alignItems:"stretch",gap:6,children:[e.jsx(f.Root,{gap:6,children:[{label:n({id:"global.name",defaultMessage:"Name"}),name:"name",required:!0,size:6,type:"string"},{label:n({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),name:"url",required:!0,size:12,type:"string"}].map(({size:m,...v})=>e.jsx(f.Item,{col:m,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(be,{...v})},v.name))}),e.jsx(_e,{}),e.jsx(c,{})]})})]})})]})}):null},We=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,Ve=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,De=({formatMessage:t})=>q().shape({name:E().nullable().required(t({id:"Settings.webhooks.validation.name.required",defaultMessage:"Name is required"})).matches(We,t({id:"Settings.webhooks.validation.name.regex",defaultMessage:"The name must start with a letter and only contain letters, numbers, spaces and underscores"})),url:E().nullable().required(t({id:"Settings.webhooks.validation.url.required",defaultMessage:"Url is required"})).matches(Ve,t({id:"Settings.webhooks.validation.url.regex",defaultMessage:"The value must be a valid Url"})),headers:fe(s=>{const r=z();if(s.length===1){const{key:a,value:h}=s[0];if(!a&&!h)return r}return r.of(q().shape({key:E().required(t({id:"Settings.webhooks.validation.key",defaultMessage:"Key is required"})).nullable(),value:E().required(t({id:"Settings.webhooks.validation.value",defaultMessage:"Value is required"})).nullable()}))}),events:z()}),U=t=>({...t,headers:t.headers.reduce((s,{key:r,value:a})=>(r!==""&&(s[r]=a),s),{})}),B=()=>{const{formatMessage:t}=j(),r=xe("/settings/webhooks/:id")?.params.id,a=r==="create",h=je(),{toggleNotification:i}=ke(),{_unstableFormatAPIError:n,_unstableFormatValidationErrors:u}=ye(),b=k.useCallback(n,[]),[c,l]=k.useState(!1),[d,o]=k.useState(),{isLoading:m,webhooks:v,error:M,createWebhook:G,updateWebhook:Z,triggerWebhook:J}=Ee({id:r},{skip:a});k.useEffect(()=>{M&&i({type:"danger",message:b(M)})},[M,i,b]);const K=async()=>{try{l(!0);const y=await J(r);if("error"in y){i({type:"danger",message:n(y.error)});return}o(y.data)}catch{i({type:"danger",message:t({id:"notification.error",defaultMessage:"An error occurred"})})}finally{l(!1)}},Q=async(y,P)=>{try{if(a){const p=await G(U(y));if("error"in p){L(p.error)&&p.error.name==="ValidationError"?P.setErrors(u(p.error)):i({type:"danger",message:n(p.error)});return}i({type:"success",message:t({id:"Settings.webhooks.created"})}),h(`../webhooks/${p.data.id}`,{replace:!0})}else{const p=await Z({id:r,...U(y)});if("error"in p){L(p.error)&&p.error.name==="ValidationError"?P.setErrors(u(p.error)):i({type:"danger",message:n(p.error)});return}i({type:"success",message:t({id:"notification.form.success.fields"})})}}catch{i({type:"danger",message:t({id:"notification.error",defaultMessage:"An error occurred"})})}};if(m)return e.jsx(H.Loading,{});const[X]=v??[];return e.jsxs(we,{children:[e.jsx(H.Title,{children:t({id:"Settings.PageTitle",defaultMessage:"Settings - {name}"},{name:"Webhooks"})}),e.jsx(Ue,{data:X,handleSubmit:Q,triggerWebhook:K,isCreating:a,isTriggering:c,triggerResponse:d})]})},Ne=()=>{const t=Se(ve);return e.jsx(H.Protect,{permissions:t.settings?.webhooks.update,children:e.jsx(B,{})})},Je=Object.freeze(Object.defineProperty({__proto__:null,EditPage:B,ProtectedEditPage:Ne},Symbol.toStringTag,{value:"Module"}));export{B as E,T as a,Je as b};
