import{a as H,q as be,B as re,aB as Ie,cn as de,j as e,co as N,F as le,T as v,cp as ce,U as S,aE as g,b7 as me,z as ee,b2 as je,bO as Ce,bh as ve,b3 as Z,cq as L,r as W,I as $,Z as Se,cr as U,aI as Fe,cb as J,g as Me,V as _e,o as ne,_ as Te,C as ke,bW as Re,aH as pe,cs as we,ct as ze,cu as te,l as ue,cv as De,aT as Ee,L as ge,bo as $e,bx as Ne}from"./strapi-D0ivxu6x.js";import{D as Oe,S as Pe,r as Le,a as Ae,b as Be,u as We,c as he,C as He}from"./sortable.esm-Bj73V_60.js";import{F as Ve}from"./FieldTypeIcon-DfHeGVpC.js";const Ue=je().shape({label:Z().required().nullable(),description:Z().nullable(),placeholder:Z().nullable(),editable:ve(),size:Ce().required()}),qe=({attribute:n,name:i,onClose:s})=>{const{formatMessage:o}=H(),{toggleNotification:d}=be(),{value:c,onChange:f}=re(i),{data:y}=Ie(void 0,{selectFromResult:m=>{if(n?.type!=="relation"||!m.data)return{data:[]};if("targetModel"in n&&typeof n.targetModel=="string"){const h=m.data.contentTypes.find(b=>b.uid===n.targetModel);if(h)return{data:Object.entries(h.attributes).reduce((b,[R,D])=>(de.includes(D.type)||b.push({label:R,value:R}),b),[])}}return{data:[]}},skip:n?.type!=="relation"});return!c||c.name===k||!n?(console.error("You've opened a field to edit without it being part of the form, this is likely a bug with Strapi. Please open an issue."),d({message:o({id:"content-manager.containers.edit-settings.modal-form.error",defaultMessage:"An error occurred while trying to open the form."}),type:"danger"}),null):e.jsx(N.Content,{children:e.jsxs(le,{method:"PUT",initialValues:c,validationSchema:Ue,onSubmit:m=>{f(i,m),s()},children:[e.jsx(N.Header,{children:e.jsxs(v,{gap:3,children:[e.jsx(Ve,{type:n.type}),e.jsx(N.Title,{children:o({id:"content-manager.containers.edit-settings.modal-form.label",defaultMessage:"Edit {fieldName}"},{fieldName:ce(c.name)})})]})}),e.jsx(N.Body,{children:e.jsx(S.Root,{gap:4,children:[{name:"label",label:o({id:g("containers.edit-settings.modal-form.label"),defaultMessage:"Label"}),size:6,type:"string"},{name:"description",label:o({id:g("containers.edit-settings.modal-form.description"),defaultMessage:"Description"}),size:6,type:"string"},{name:"placeholder",label:o({id:g("containers.edit-settings.modal-form.placeholder"),defaultMessage:"Placeholder"}),size:6,type:"string"},{name:"editable",label:o({id:g("containers.edit-settings.modal-form.editable"),defaultMessage:"Editable"}),size:6,type:"boolean"},{name:"mainField",label:o({id:g("containers.edit-settings.modal-form.mainField"),defaultMessage:"Entry title"}),hint:o({id:g("containers.SettingPage.edit-settings.modal-form.mainField.hint"),defaultMessage:"Set the displayed field"}),size:6,options:y,type:"enumeration"},{name:"size",label:o({id:g("containers.ListSettingsView.modal-form.size"),defaultMessage:"Size"}),size:6,options:[{value:"4",label:"33%"},{value:"6",label:"50%"},{value:"8",label:"66%"},{value:"12",label:"100%"}],type:"enumeration"}].filter(Ke(n.type)).map(({size:m,...h})=>e.jsx(S.Item,{col:m,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(me,{...h})},h.name))})}),e.jsxs(N.Footer,{children:[e.jsx(N.Close,{children:e.jsx(ee,{variant:"tertiary",children:o({id:"app.components.Button.cancel",defaultMessage:"Cancel"})})}),e.jsx(ee,{type:"submit",children:o({id:"global.finish",defaultMessage:"Finish"})})]})]})})},Ke=n=>i=>{switch(n){case"blocks":case"richtext":return i.name!=="size"&&i.name!=="mainField";case"boolean":case"media":return i.name!=="placeholder"&&i.name!=="mainField";case"component":return i.name==="label"||i.name==="editable";case"dynamiczone":case"json":return i.name!=="placeholder"&&i.name!=="mainField"&&i.name!=="size";case"relation":return!0;default:return i.name!=="mainField"}},P=12,Ye=({id:n,children:i})=>{const s=We({id:n});return i(s)},Ge=({id:n,children:i})=>{const{attributes:s,setNodeRef:o,transform:d,transition:c,isDragging:f}=he({id:n}),y={transform:He.Transform.toString({x:d?.x??0,y:d?.y??0,scaleX:1,scaleY:1}),transition:c,height:"100%",opacity:f?.6:1,outlineOffset:2};return e.jsx("div",{ref:o,style:y,...s,children:i})},se=n=>n.map((i,s)=>({...i,dndId:`container-${s}`,children:i.children.map((o,d)=>({...o,dndId:`container-${s}-child-${d}`,formName:`layout.${s}.children.${d}`}))})),Qe=({attributes:n,fieldSizes:i,components:s,metadatas:o={}})=>{const{formatMessage:d}=H(),c=L("Fields",t=>t.values.layout??[]),f=L("Fields",t=>t.onChange),y=L("Fields",t=>t.addFieldRow),m=L("Fields",t=>t.removeFieldRow),h=c.map(t=>t.children.map(a=>a.name)).flat(),b=Object.entries(o).reduce((t,a)=>{const[r,{visible:l,...I}]=a;if(!h.includes(r)&&l===!0){const x=n[r]?.type,j=x?i[x]:P;t.push({...I,label:I.label??r,name:r,size:j})}return t},[]),R=(t,a)=>()=>{c[t].children.length===1?m("layout",t):f(`layout.${t}.children`,[...c[t].children.slice(0,a),...c[t].children.slice(a+1)])},D=t=>()=>{y("layout",{children:[t]})},[F,p]=W.useState(()=>se(c)),[E,A]=W.useState(null);function B(t,a){return t in a?t:Object.keys(a).find(r=>a[r].children.find(l=>l.dndId===t))}const q=(t,a)=>a.children.find(r=>t===r.dndId),K=()=>Object.fromEntries(F.map(t=>[t.dndId,t])),fe=t=>t.map(a=>({...a,children:a.children.filter(r=>r.name!==k)})).filter(a=>a.children.length>0).map(a=>{const r=a.children.reduce((l,I)=>l+I.size,0);if(r<P){const[l]=te(a.children.at(-1)?.__temp_key__,void 0,1);return{...a,children:[...a.children,{name:k,size:P-r,__temp_key__:l}]}}return a});return W.useEffect(()=>{const t=se(c);p(t)},[c,p]),e.jsx(Oe,{onDragStart:t=>{const a=K(),r=B(t.active.id,a);if(!r)return;const l=q(t.active.id,a[r]);l&&A(l)},onDragOver:({active:t,over:a})=>{const r=K(),l=B(t.id,r),I=B(a?.id??"",r),x=F.findIndex(u=>u.dndId===l),j=F.findIndex(u=>u.dndId===I);if(!l||!I)return;const C=q(t.id,r[l]),w=q(a?.id??"",r[I]),O=r[I].children.findIndex(u=>u.dndId===a?.id),V=r[l].children.findIndex(u=>u.dndId===t.id);if(!C)return;if(C?.size===P){const u=J(F,M=>{M[x].children=F[j].children,M[j].children=F[x].children});p(u);return}const Y=J(F,u=>{u[x].children=u[x].children.filter(T=>T.dndId!==t.id);const M=u[j].children,_=M.reduce((T,z)=>z.name===k?T:T+z.size,0),G=_+C.size>P,Q=w&&w.name!==k&&w.size===C.size&&V!==-1&&O!==-1,ie=x!==j&&P-_===0,ae=w?.name===k;if(G){if(Q){u[x].children.splice(V,0,w);const z=M.findIndex(X=>X.dndId===w.dndId);z!==-1&&M.splice(z,1,C);return}if(ie){const T=j+1,z=u[T];if(z&&z.children.filter(ye=>ye.name!==k).length===0){z.children=[C];return}const X=u[j],xe=`container-${u.length}`;u.splice(T,0,{...X,dndId:xe,children:[C]});return}}if(ae){M.splice(O,1,C);return}M.splice(O,0,C)});p(Y)},onDragEnd:t=>{const{active:a,over:r}=t,{id:l}=a,I=r?.id,x=K(),j=B(l,x),C=B(I,x);if(!j||!C)return;const w=x[j].children.findIndex(_=>_.dndId===l),O=x[C].children.findIndex(_=>_.dndId===I),V=J(x,_=>{w!==O&&j===C&&(_[j].children=Be(_[j].children,w,O))}),Y=Object.values(V),M=fe(Y).map(({dndId:_,children:G,...Q})=>({...Q,children:G.map(({dndId:ie,formName:ae,...T})=>T)}));f("layout",M),A(null)},children:e.jsxs(v,{paddingTop:6,direction:"column",alignItems:"stretch",gap:4,children:[e.jsxs(v,{alignItems:"flex-start",direction:"column",justifyContent:"space-between",children:[e.jsx($,{fontWeight:"bold",children:d({id:g("containers.list.displayedFields"),defaultMessage:"Displayed fields"})}),e.jsx($,{variant:"pi",textColor:"neutral600",children:d({id:"containers.SettingPage.editSettings.description",defaultMessage:"Drag & drop the fields to build the layout"})})]}),e.jsx(Se,{padding:4,hasRadius:!0,borderStyle:"dashed",borderWidth:"1px",borderColor:"neutral300",children:e.jsxs(v,{direction:"column",alignItems:"stretch",gap:2,children:[F.map((t,a)=>e.jsx(Pe,{id:t.dndId,items:t.children.map(r=>({id:r.dndId})),strategy:Le,children:e.jsx(Ye,{id:t.dndId,children:({setNodeRef:r})=>e.jsx(S.Root,{ref:r,gap:2,children:t.children.map((l,I)=>e.jsx(S.Item,{col:l.size,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(Ge,{id:l.dndId,children:e.jsx(oe,{attribute:n[l.name],components:s,name:l.formName,onRemoveField:R(a,I),dndId:l.dndId})})},l.dndId))},t.dndId)})},t.dndId)),e.jsx(Ae,{children:E?e.jsx(oe,{attribute:n[E.name],components:s,name:E.formName,dndId:E.dndId}):null}),e.jsxs(U.Root,{children:[e.jsx(U.Trigger,{startIcon:e.jsx(Fe,{}),endIcon:null,disabled:b.length===0,fullWidth:!0,variant:"secondary",children:d({id:g("containers.SettingPage.add.field"),defaultMessage:"Insert another field"})}),e.jsx(U.Content,{children:b.map(t=>e.jsx(U.Item,{onSelect:D(t),children:t.label},t.name))})]})]})})]})})},k="_TEMP_",oe=({attribute:n,components:i,name:s,onRemoveField:o,dndId:d})=>{const c=Me(),[f,y]=W.useState(!1),{formatMessage:m}=H(),{value:h}=re(s),{listeners:b,setActivatorNodeRef:R}=he({id:d}),D=p=>{p.preventDefault(),p.stopPropagation(),o&&o?.(p)},F=p=>{p.preventDefault(),p.stopPropagation(),y(!0)};return h?h.name===k?e.jsx(v,{tag:"span",height:"100%",style:{opacity:0}}):n?e.jsxs(N.Root,{open:f,onOpenChange:y,children:[e.jsxs(v,{borderColor:"neutral150",background:"neutral100",hasRadius:!0,gap:3,cursor:"pointer",onClick:()=>{y(!0)},position:"relative",children:[c&&e.jsx(Xe,{ref:R,tag:"span",withTooltip:!1,label:m({id:g("components.DraggableCard.move.field"),defaultMessage:"Move {item}"},{item:h.label}),...b,children:e.jsx(_e,{})}),e.jsxs(v,{direction:"column",alignItems:"flex-start",grow:1,overflow:"hidden",children:[e.jsxs(v,{gap:3,justifyContent:"space-between",width:"100%",children:[e.jsx($,{ellipsis:!0,fontWeight:"bold",children:h.label}),e.jsxs(v,{position:"relative",children:[e.jsx(ne,{type:"button",variant:"ghost",background:"transparent",onClick:F,withTooltip:!1,label:m({id:g("components.DraggableCard.edit.field"),defaultMessage:"Edit {item}"},{item:h.label}),children:e.jsx(Te,{})}),e.jsx(ne,{type:"button",variant:"ghost",onClick:D,background:"transparent",withTooltip:!1,label:m({id:g("components.DraggableCard.delete.field"),defaultMessage:"Delete {item}"},{item:h.label}),children:e.jsx(ke,{})})]})]}),n?.type==="component"?e.jsxs(v,{paddingTop:3,paddingRight:3,paddingBottom:3,paddingLeft:0,alignItems:"flex-start",direction:"column",gap:2,width:"100%",children:[e.jsx(S.Root,{gap:4,width:"100%",children:i[n.component].layout.map(p=>p.map(({size:E,...A})=>e.jsx(S.Item,{col:E,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(v,{alignItems:"center",background:"neutral0",paddingTop:2,paddingBottom:2,paddingLeft:3,paddingRight:3,hasRadius:!0,borderColor:"neutral200",children:e.jsx($,{textColor:"neutral800",children:A.name})})},A.name)))}),e.jsx(Re,{onClick:p=>p.stopPropagation(),startIcon:e.jsx(we,{}),tag:pe,to:`../components/${n.component}/configurations/edit`,children:m({id:g("components.FieldItem.linkToComponentLayout"),defaultMessage:"Set the component's layout"})})]}):null,n?.type==="dynamiczone"?e.jsx(v,{paddingTop:3,paddingRight:3,paddingBottom:3,paddingLeft:0,alignItems:"flex-start",gap:2,width:"100%",wrap:"wrap",children:n?.components.map(p=>e.jsxs(Ze,{onClick:E=>E.stopPropagation(),to:`../components/${p}/configurations/edit`,children:[e.jsx(ze,{icon:i[p].settings.icon}),e.jsx($,{fontSize:1,textColor:"neutral600",fontWeight:"bold",children:i[p].settings.displayName})]},p))}):null]})]}),h.name!==k&&e.jsx(qe,{attribute:n,name:s,onClose:()=>y(!1)})]}):null:null},Xe=ue(ne)`
  height: unset;
  align-self: stretch;
  display: flex;
  align-items: center;
  padding: 0;
  border: none;
  background-color: transparent;
  border-radius: 0px;
  border-right: 1px solid ${({theme:n})=>n.colors.neutral150};
  cursor: all-scroll;

  svg {
    width: 1.2rem;
    height: 1.2rem;
  }
`,Ze=ue(pe)`
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: ${({theme:n})=>n.spaces[1]};
  padding: ${n=>n.theme.spaces[2]};
  border: 1px solid ${({theme:n})=>n.colors.neutral200};
  background: ${({theme:n})=>n.colors.neutral0};
  width: 14rem;
  border-radius: ${({theme:n})=>n.borderRadius};
  text-decoration: none;

  &:focus,
  &:hover {
    ${({theme:n})=>`
      background-color: ${n.colors.primary100};
      border-color: ${n.colors.primary200};

      ${$} {
          color: ${n.colors.primary600};
      }
    `}

    /* > ComponentIcon */
    > div:first-child {
      background: ${({theme:n})=>n.colors.primary200};
      color: ${({theme:n})=>n.colors.primary600};

      svg {
        path {
          fill: ${({theme:n})=>n.colors.primary600};
        }
      }
    }
  }
`,mn=({attributes:n,fieldSizes:i,layout:s,onSubmit:o})=>{const{components:d,settings:c,layout:f,metadatas:y}=s,{formatMessage:m}=H(),h=W.useMemo(()=>({layout:De(Je,en,nn,tn,an)(f),settings:c}),[f,c]);return e.jsx(e.Fragment,{children:e.jsx(Ee,{children:e.jsxs(le,{initialValues:h,onSubmit:o,method:"PUT",children:[e.jsx(sn,{name:c.displayName??""}),e.jsx(ge.Content,{children:e.jsxs(v,{alignItems:"stretch",background:"neutral0",direction:"column",gap:6,hasRadius:!0,shadow:"tableShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:[e.jsx($,{variant:"delta",tag:"h2",children:m({id:g("containers.SettingPage.settings"),defaultMessage:"Settings"})}),e.jsxs(S.Root,{children:[e.jsx(S.Item,{col:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(me,{type:"enumeration",label:m({id:g("containers.SettingPage.editSettings.entry.title"),defaultMessage:"Entry title"}),hint:m({id:g("containers.SettingPage.editSettings.entry.title.description"),defaultMessage:"Set the display field of your entry"}),name:"settings.mainField",options:Object.entries(n).reduce((b,[R,D])=>(D&&(de.includes(D.type)||b.push({label:R,value:R})),b),[])})}),e.jsx(S.Item,{paddingTop:6,paddingBottom:6,col:12,s:12,direction:"column",alignItems:"stretch",children:e.jsx($e,{})}),e.jsx(S.Item,{col:12,s:12,direction:"column",alignItems:"stretch",children:e.jsx($,{variant:"delta",tag:"h3",children:m({id:g("containers.SettingPage.view"),defaultMessage:"View"})})}),e.jsx(S.Item,{col:12,s:12,direction:"column",alignItems:"stretch",children:e.jsx(Qe,{attributes:n,components:d,fieldSizes:i,metadatas:y})})]})]})})]})})})},Je=n=>n.flat(1),en=n=>n.map(i=>i.map(s=>({...s,mainField:s.mainField?.name}))),nn=n=>n.map(i=>i.map(({label:s,disabled:o,hint:d,placeholder:c,size:f,name:y,mainField:m})=>({label:s,editable:!o,description:d,mainField:m,placeholder:c,size:f,name:y,__temp_key__:""}))),tn=n=>[...n.map(i=>{const s=i.reduce((o,d)=>o+d.size,0);return s<12?[...i,{name:k,size:12-s,__temp_key__:""}]:i})],an=n=>{const i=te(void 0,void 0,n.length);return n.map((s,o)=>{const d=te(void 0,void 0,s.length);return{__temp_key__:i[o],children:s.map((c,f)=>({...c,__temp_key__:d[f]}))}})},sn=({name:n})=>{const{formatMessage:i}=H(),s=L("Header",d=>d.modified),o=L("Header",d=>d.isSubmitting);return e.jsx(ge.Header,{title:i({id:g("components.SettingsViewWrapper.pluginHeader.title"),defaultMessage:"Configure the view - {name}"},{name:ce(n)}),subtitle:i({id:g("components.SettingsViewWrapper.pluginHeader.description.edit-settings"),defaultMessage:"Customize how the edit view will look like."}),navigationAction:e.jsx(Ne,{}),primaryAction:e.jsx(ee,{disabled:!s,loading:o,type:"submit",children:i({id:"global.save",defaultMessage:"Save"})})})};export{mn as C,k as T};
