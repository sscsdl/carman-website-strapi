import{a as w,b as G,a3 as Se,u as H,e$ as Ae,r as S,f0 as ge,bB as me,e9 as Ie,bk as pe,f1 as Me,es as X,j as e,cA as N,f2 as Le,B as Te,D as Ee,E as Re,eA as Fe,f3 as ke,cr as E,a5 as we,I as A,bp as ee,f4 as ne,a4 as fe,T as v,l as te,el as he,az as se,a$ as Pe,f5 as ve,aE as P,n as Oe,f6 as Z,w as xe,dr as J,o as De,cs as He,aG as $e,aH as Be,aR as z,f7 as _e,ey as je,ea as Ne,aZ as Ue,bG as Ve,Q as We,q as ze,p as qe,f8 as ae,f9 as Ge,fa as Qe,ez as Ye,fb as Ze,ec as Je,ak as Ke,dP as Xe,P as k,bM as U,Z as V,bx as ie,L as $,fc as re,aF as et,K as tt,bU as y,$ as st,fd as nt,cB as K,bq as at,ep as it,ex as rt,z as lt,a2 as ot,aI as ct,fe as dt,ff as ut,fg as gt}from"./strapi-D0ivxu6x.js";import{S as le}from"./SearchInput-BlCSDN9b.js";import{u as mt}from"./hooks-DlkdeZm2.js";const oe=["json","component","media","richtext","dynamiczone","password","blocks"],pt=["createdAt","updatedAt"],ft=[...ge,"strapi_assignee"],ce=({disabled:t,schema:n})=>{const{attributes:s,uid:a,options:c}=n,{formatMessage:u,locale:p}=w(),{trackUsage:o}=G(),r=Se("FiltersImpl",m=>m.permissions),[{query:d}]=H(),{schemas:C}=Ae(),M=S.useMemo(()=>r.filter(m=>m.action==="admin::users.read"&&m.subject===null).length>0,[r]),j=(d?.filters?.$and??[]).reduce((m,b)=>{const[x,f]=Object.entries(b)[0];if(typeof f.id!="object")return m;const R=f.id.$eq||f.id.$ne,I=s[x],F=I?.type==="relation"&&"target"in I&&I.target==="admin::user";return R&&(F||ft.includes(x))&&!m.includes(R)&&m.push(R),m},[]),{data:L,isLoading:g}=me({filters:{id:{$in:j}}},{skip:j.length===0||!M}),{users:l=[]}=L??{},{metadata:O}=Ie(a,{selectFromResult:({data:m})=>({metadata:m?.contentType.metadatas??{}})}),B=pe(p,{sensitivity:"base"}),D=S.useMemo(()=>{const[{properties:{fields:m=[]}={fields:[]}}]=r.filter(x=>x.action==="plugin::content-manager.explorer.read"&&x.subject===a);return["id","documentId",...m.filter(x=>{const f=s[x]??{};return f.type&&!oe.includes(f.type)}),...pt,...M?ge:[]].map(x=>{const f=s[x];if(oe.includes(f.type))return null;const{mainField:R="",label:I}=O[x].list;let F={name:x,label:I??"",mainField:Me(f,R,{schemas:C,components:{}}),type:f.type};return f.type==="relation"&&"target"in f&&f.target==="admin::user"&&(F={...F,input:ht,options:l.map(i=>({label:X(i),value:i.id.toString()})),operators:[{label:u({id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"}),value:"$eq"},{label:u({id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"}),value:"$ne"}],mainField:{name:"id",type:"integer"}}),f.type==="enumeration"&&(F={...F,options:f.enum.map(i=>({label:i,value:i}))}),F}).filter(Boolean).toSorted((x,f)=>B.compare(x.label,f.label))},[r,M,a,s,O,C,l,u,B]),Q=m=>{m&&o("willFilterEntries")},_=m=>{const b=s[m.name];b&&o("didFilterEntries",{useRelation:b.type==="relation"})};return e.jsxs(N.Root,{disabled:t,options:D,onOpenChange:Q,onChange:_,children:[e.jsx(N.Trigger,{}),e.jsx(N.Popover,{zIndex:499}),e.jsx(N.List,{})]})},ht=({name:t})=>{const[n,s]=S.useState(10),[a,c]=S.useState(""),{formatMessage:u}=w(),p=Le(a,300),{data:o,isLoading:r}=me({pageSize:n,_q:p}),d=Te(t),C=l=>{l||s(10)},{users:M=[],pagination:j}=o??{},{pageCount:L=1,page:g=1}=j??{};return e.jsx(Ee,{value:d.value,"aria-label":u({id:"content-manager.components.Filters.usersSelect.label",defaultMessage:"Search and select a user to filter"}),onOpenChange:C,onChange:l=>d.onChange(t,l),loading:r,onLoadMore:()=>s(n+10),hasMoreItems:g<L,onInputChange:l=>{c(l.currentTarget.value)},children:M.map(l=>e.jsx(Re,{value:l.id.toString(),children:X(l)},l.id))})},q=({type:t,value:n})=>{const{formatDate:s,formatTime:a,formatNumber:c}=w();let u=n;if(t==="date"&&(u=s(Fe(n),{dateStyle:"full"})),t==="datetime"&&(u=s(n,{dateStyle:"full",timeStyle:"short"})),t==="time"){const[p,o,r]=n.split(":"),d=new Date;d.setHours(p),d.setMinutes(o),d.setSeconds(r),u=a(d,{timeStyle:"short"})}return["float","decimal"].includes(t)&&(u=c(n,{maximumFractionDigits:20})),["integer","biginteger"].includes(t)&&(u=c(n,{maximumFractionDigits:0})),ke(u)},xt=({content:t,mainField:n})=>n?e.jsx(ee,{label:t[n.name],children:e.jsx(A,{maxWidth:"25rem",textColor:"neutral800",ellipsis:!0,children:e.jsx(q,{type:n.type,value:t[n.name]})})}):null,jt=({content:t,mainField:n})=>{const{formatMessage:s}=w();return n?e.jsxs(E.Root,{children:[e.jsxs(E.Trigger,{onClick:a=>a.stopPropagation(),children:[e.jsx(we,{children:t.length}),s({id:"content-manager.containers.list.items",defaultMessage:"{number, plural, =0 {items} one {item} other {items}}"},{number:t.length})]}),e.jsx(E.Content,{children:t.map(a=>e.jsx(E.Item,{disabled:!0,children:e.jsx(A,{maxWidth:"50rem",ellipsis:!0,children:e.jsx(q,{type:n.type,value:a[n.name]})})},a.id))})]}):null},yt=t=>t&&t[0]==="."?t.substring(1):t,ye=({url:t,mime:n,alternativeText:s,name:a,ext:c,formats:u})=>{const p=ne(t);if(n.includes("image")){const d=u?.thumbnail?.url,C=ne(d)||p;return e.jsx(fe.Item,{src:C,alt:s||a,fallback:s||a,preview:!0})}const o=yt(c),r=a.length>100?`${a.substring(0,100)}...`:a;return e.jsx(ee,{label:r,children:e.jsx("span",{children:e.jsx(be,{children:o})})})},be=({children:t})=>e.jsx(v,{tag:"span",position:"relative",borderRadius:"50%",width:"26px",height:"26px",borderColor:"neutral200",background:"neutral150",paddingLeft:"1px",justifyContent:"center",alignItems:"center",children:e.jsx(bt,{variant:"sigma",textColor:"neutral600",children:t})}),bt=te(A)`
  font-size: 0.9rem;
  line-height: 0.9rem;
`,Ct=({content:t})=>e.jsx(fe.Group,{children:t.map((n,s)=>{const a=`${n.id}${s}`;if(s===3){const c=`+${t.length-3}`;return e.jsx(be,{children:c},a)}return s>3?null:e.jsx(ye,{...n},a)})}),St=({mainField:t,content:n})=>e.jsx(A,{maxWidth:"50rem",textColor:"neutral800",ellipsis:!0,children:he(n,t)}),At=({mainField:t,content:n,rowId:s,name:a})=>{const{model:c}=se(),{formatMessage:u}=w(),{notifyStatus:p}=Pe(),[o,r]=S.useState(!1),[{query:d}]=H(),C=d.plugins?.i18n?.locale,[M]=a.split("."),{data:j,isLoading:L}=ve({model:c,id:s,targetField:M,params:{locale:C}},{skip:!o,refetchOnMountOrArgChange:!0}),g=Array.isArray(n)?n.length:n.count;return S.useEffect(()=>{j&&p(u({id:P("DynamicTable.relation-loaded"),defaultMessage:"Relations have been loaded"}))},[j,u,p]),e.jsxs(E.Root,{onOpenChange:l=>r(l),children:[e.jsx(E.Trigger,{onClick:l=>l.stopPropagation(),children:e.jsx(A,{style:{cursor:"pointer"},textColor:"neutral800",fontWeight:"regular",children:g>0?u({id:"content-manager.containers.list.items",defaultMessage:"{number} {number, plural, =0 {items} one {item} other {items}}"},{number:g}):"-"})}),e.jsxs(E.Content,{children:[L&&e.jsx(E.Item,{disabled:!0,children:e.jsx(Oe,{small:!0,children:u({id:P("ListViewTable.relation-loading"),defaultMessage:"Relations are loading"})})}),j?.results&&e.jsxs(e.Fragment,{children:[j.results.map(l=>e.jsx(E.Item,{children:e.jsx(A,{maxWidth:"50rem",ellipsis:!0,children:he(l,t)})},l.documentId)),j?.pagination&&j?.pagination.total>10&&e.jsx(E.Item,{"aria-disabled":!0,"aria-label":u({id:P("ListViewTable.relation-more"),defaultMessage:"This relation contains more entities than displayed"}),children:e.jsx(A,{children:"â€¦"})})]})]})]})},It=({content:t,mainField:n,attribute:s,rowId:a,name:c})=>{if(!Mt(t,n,s))return e.jsx(A,{textColor:"neutral800",paddingLeft:s.type==="relation"?"1.6rem":0,paddingRight:s.type==="relation"?"1.6rem":0,children:"-"});switch(s.type){case"media":return s.multiple?e.jsx(Ct,{content:t}):e.jsx(ye,{...t});case"relation":return Ce(s.relation)?e.jsx(St,{mainField:n,content:t}):e.jsx(At,{rowId:a,mainField:n,content:t,name:c});case"component":return s.repeatable?e.jsx(jt,{mainField:n,content:t}):e.jsx(xt,{mainField:n,content:t});case"string":return e.jsx(ee,{label:t,children:e.jsx(A,{maxWidth:"30rem",ellipsis:!0,textColor:"neutral800",children:e.jsx(q,{type:s.type,value:t})})});default:return e.jsx(A,{maxWidth:"30rem",ellipsis:!0,textColor:"neutral800",children:e.jsx(q,{type:s.type,value:t})})}},Mt=(t,n,s)=>{if(s.type==="component"){if(s.repeatable||!n)return t?.length>0;const a=t?.[n.name];return n.name==="id"&&![void 0,null].includes(a)?!0:!Z(a)}return s.type==="relation"?Ce(s.relation)?!Z(t):Array.isArray(t)?t.length>0:t?.count>0:["integer","decimal","float","number"].includes(s.type)?typeof t=="number":s.type==="boolean"?t!==null:!Z(t)},Ce=t=>["oneToOne","manyToOne","oneToOneMorph"].includes(t),de=t=>{const n=mt(u=>u.admin_app.permissions.contentManager?.collectionTypesConfigurations??[]),[{query:s}]=H(),{formatMessage:a}=w(),{allowedActions:{canConfigureView:c}}=xe(n);return e.jsxs(J.Root,{children:[e.jsx(J.Trigger,{children:e.jsx(De,{label:a({id:"components.ViewSettings.tooltip",defaultMessage:"View Settings"}),children:e.jsx(He,{})})}),e.jsx(J.Content,{side:"bottom",align:"end",sideOffset:4,children:e.jsxs(v,{alignItems:"stretch",direction:"column",padding:3,gap:3,children:[c?e.jsx($e,{size:"S",startIcon:e.jsx(_e,{}),variant:"secondary",tag:Be,to:{pathname:"configurations/list",search:s.plugins?z.stringify({plugins:s.plugins},{encode:!1}):""},children:a({id:"app.links.configure-view",defaultMessage:"Configure the view"})}):null,e.jsx(Lt,{...t})]})})]})},Lt=({headers:t=[],resetHeaders:n,setHeaders:s})=>{const{trackUsage:a}=G(),{formatMessage:c,locale:u}=w(),{schema:p,model:o}=se(),{list:r}=je(o),d=pe(u,{sensitivity:"base"}),C=p?.attributes??{},M=Object.keys(C).filter(g=>Ne(C[g])).map(g=>({name:g,label:r.metadatas[g]?.label??""})).sort((g,l)=>d.compare(g.label,l.label)),j=g=>{a("didChangeDisplayedFields");const l=t.includes(g)?t.filter(O=>O!==g):[...t,g];s(l)},L=()=>{n()};return e.jsxs(v,{tag:"fieldset",direction:"column",alignItems:"stretch",gap:1,borderWidth:0,maxHeight:"240px",padding:1,overflow:"auto",children:[e.jsxs(v,{justifyContent:"space-between",gap:2,children:[e.jsx(A,{tag:"legend",variant:"pi",fontWeight:"bold",children:c({id:"containers.list.displayedFields",defaultMessage:"Displayed fields"})}),e.jsx(Ue,{onClick:L,children:c({id:"app.components.Button.reset",defaultMessage:"Reset"})})]}),e.jsx(v,{direction:"column",alignItems:"stretch",children:M.map(g=>{const l=t.includes(g.name);return e.jsx(v,{wrap:"wrap",gap:2,background:l?"primary100":"transparent",hasRadius:!0,padding:2,marginBottom:1,children:e.jsx(Ve,{onCheckedChange:()=>j(g.name),checked:l,name:g.name,children:e.jsx(A,{fontSize:1,children:g.label})})},g.name)})})]})},{INJECT_COLUMN_IN_TABLE:Tt}=Xe,ue=te($.Header)`
  overflow-wrap: anywhere;
`,Et=()=>{const{trackUsage:t}=G(),n=We(),{formatMessage:s}=w(),{toggleNotification:a}=ze(),{_unstableFormatAPIError:c}=qe(P);ae("STRAPI_LIST_VIEW_SETTINGS:",["sort","filters","pageSize"]),ae("STRAPI_LOCALE",["plugins.i18n.locale"],!1);const{collectionType:u,model:p,schema:o}=se(),{list:r}=je(p),[d,C]=Ge(`STRAPI_LIST_VIEW_DISPLAYED_HEADERS:${p}`,null),M=i=>i.map(T=>T.name),j=S.useMemo(()=>!d||!r.metadatas||Object.keys(r.metadatas).length<=0||!o?.attributes?[]:Qe(d,o.attributes,r.metadatas),[d,o,r]),L=i=>{C(i)},g=()=>{C(M(r.layout))};S.useEffect(()=>{r.layout.length!==0&&(d||g())},[r.layout]),S.useEffect(()=>{if(!o?.attributes||!d||d.length===0||o.uid!==p)return;const i=d.filter(T=>Object.keys(o?.attributes).includes(T));i.length!==d.length&&L(i)},[d]);const[{query:l}]=H({page:"1",pageSize:r.settings.pageSize.toString(),sort:r.settings.defaultSortBy?`${r.settings.defaultSortBy}:${r.settings.defaultSortOrder}`:""}),O=S.useMemo(()=>Ye(l),[l]),{data:B,error:D,isLoading:Q,isFetching:_}=Ze({model:p,params:O});S.useEffect(()=>{D&&a({type:"danger",message:c(D)})},[D,c,a]);const{results:m=[],pagination:b}=B??{};S.useEffect(()=>{b&&b.pageCount>0&&b.page>b.pageCount&&n({search:z.stringify({...l,page:b.pageCount})},{replace:!0})},[b,s,l,n]);const{canCreate:x}=Je("ListViewPage",({canCreate:i})=>({canCreate:i})),f=Ke("ListViewPage",({runHookWaterfall:i})=>i),R=S.useMemo(()=>{const T=f(Tt,{displayedHeaders:j,layout:r}).displayedHeaders.map(h=>{const Y=typeof h.label=="string"?{id:`content-manager.content-types.${p}.${h.name}`,defaultMessage:h.label}:h.label;return{...h,label:s(Y),name:`${h.name}${h.mainField?.name?`.${h.mainField.name}`:""}`}});return o?.options?.draftAndPublish&&T.push({attribute:{type:"custom"},name:"status",label:s({id:P("containers.list.table-headers.status"),defaultMessage:"status"}),searchable:!1,sortable:!1}),T},[j,s,r,f,o?.options?.draftAndPublish,p]);if(Q)return e.jsx(k.Loading,{});if(D)return e.jsx(k.Error,{});const I=o?.info.displayName?s({id:o.info.displayName,defaultMessage:o.info.displayName}):s({id:"content-manager.containers.untitled",defaultMessage:"Untitled"}),F=i=>()=>{t("willEditEntryFromList"),n({pathname:i.toString(),search:z.stringify({plugins:l.plugins})})};return!_&&m.length===0?e.jsxs(e.Fragment,{children:[e.jsx(U.contentManager.Introduction,{children:e.jsx(V,{})}),e.jsxs(k.Main,{children:[e.jsx(k.Title,{children:`${I}`}),e.jsx(ue,{primaryAction:x?e.jsx(U.contentManager.CreateNewEntry,{children:e.jsx(W,{})}):null,subtitle:s({id:P("pages.ListView.header-subtitle"),defaultMessage:"{number, plural, =0 {# entries} one {# entry} other {# entries}} found"},{number:b?.total}),title:I,navigationAction:e.jsx(ie,{})}),e.jsx($.Action,{endActions:e.jsxs(e.Fragment,{children:[e.jsx(re,{area:"listView.actions"}),e.jsx(de,{setHeaders:L,resetHeaders:g,headers:d??[]})]}),startActions:e.jsxs(e.Fragment,{children:[r.settings.searchable&&e.jsx(le,{label:s({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:I}),placeholder:s({id:"global.search",defaultMessage:"Search"}),trackedEvent:"didSearch"}),r.settings.filterable&&o?e.jsx(ce,{schema:o}):null]})}),e.jsx($.Content,{children:e.jsx(V,{background:"neutral0",shadow:"filterShadow",hasRadius:!0,children:e.jsx(et,{action:x&&e.jsx(V,{children:e.jsx(W,{variant:"secondary"})}),content:s({id:"app.components.EmptyStateLayout.content-document",defaultMessage:"No content found"}),hasRadius:!0,icon:e.jsx(tt,{width:"16rem"})})})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(U.contentManager.Introduction,{children:e.jsx(V,{})}),e.jsxs(k.Main,{children:[e.jsx(k.Title,{children:`${I}`}),e.jsx(ue,{primaryAction:x?e.jsx(U.contentManager.CreateNewEntry,{children:e.jsx(W,{})}):null,subtitle:s({id:P("pages.ListView.header-subtitle"),defaultMessage:"{number, plural, =0 {# entries} one {# entry} other {# entries}} found"},{number:b?.total}),title:I,navigationAction:e.jsx(ie,{})}),e.jsx($.Action,{endActions:e.jsxs(e.Fragment,{children:[e.jsx(re,{area:"listView.actions"}),e.jsx(de,{setHeaders:L,resetHeaders:g,headers:d??[]})]}),startActions:e.jsxs(e.Fragment,{children:[r.settings.searchable&&e.jsx(le,{disabled:m.length===0,label:s({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:I}),placeholder:s({id:"global.search",defaultMessage:"Search"}),trackedEvent:"didSearch"}),r.settings.filterable&&o?e.jsx(ce,{disabled:m.length===0,schema:o}):null]})}),e.jsx($.Content,{children:e.jsxs(v,{gap:4,direction:"column",alignItems:"stretch",children:[e.jsxs(y.Root,{rows:m,headers:R,isLoading:_,children:[e.jsx(Ft,{}),e.jsxs(y.Content,{children:[e.jsxs(y.Head,{children:[e.jsx(y.HeaderCheckboxCell,{}),R.map(i=>e.jsx(y.HeaderCell,{...i},i.name))]}),e.jsx(y.Loading,{}),e.jsx(y.Empty,{action:x?e.jsx(W,{variant:"secondary"}):null}),e.jsx(y.Body,{children:m.map(i=>e.jsxs(y.Row,{cursor:"pointer",onClick:F(i.documentId),children:[e.jsx(y.CheckboxCell,{id:i.id}),R.map(({cellFormatter:T,...h})=>{if(h.name==="status"){const{status:Y}=i;return e.jsx(y.Cell,{children:e.jsx(st,{status:Y,maxWidth:"min-content"})},h.name)}return["createdBy","updatedBy"].includes(h.name.split(".")[0])?e.jsx(y.Cell,{children:e.jsx(A,{textColor:"neutral800",children:i[h.name.split(".")[0]]?X(i[h.name.split(".")[0]]):"-"})},h.name):typeof T=="function"?e.jsx(y.Cell,{children:T(i,h,{collectionType:u,model:p})},h.name):e.jsx(y.Cell,{children:e.jsx(It,{content:i[h.name.split(".")[0]],rowId:i.documentId,...h})},h.name)}),e.jsx(Rt,{onClick:T=>T.stopPropagation(),children:e.jsx(nt,{document:i})})]},i.id))})]})]}),e.jsxs(K.Root,{...b,onPageSizeChange:()=>t("willChangeNumberOfEntriesPerPage"),children:[e.jsx(K.PageSize,{}),e.jsx(K.Links,{})]})]})})]})]})},Rt=te(y.Cell)`
  display: flex;
  justify-content: flex-end;
`,Ft=()=>{const t=dt("TableActionsBar",c=>c.selectRow),[{query:n}]=H(),s=n?.plugins?.i18n?.locale,a=ut(s);return S.useEffect(()=>{a!==s&&t([])},[t,a,s]),e.jsx(y.ActionBar,{children:e.jsx(gt,{})})},W=({variant:t})=>{const{formatMessage:n}=w(),{trackUsage:s}=G(),[{query:a}]=H();return e.jsx(lt,{variant:t,tag:ot,onClick:()=>{s("willCreateEntry",{status:"draft"})},startIcon:e.jsx(ct,{}),style:{textDecoration:"none"},to:{pathname:"create",search:z.stringify({plugins:a.plugins})},minWidth:"max-content",fullWidth:!0,children:n({id:P("HeaderLayout.button.label-add-entry"),defaultMessage:"Create new entry"})})},vt=()=>{const{slug:t=""}=at(),{permissions:n=[],isLoading:s,error:a}=xe(it.map(c=>({action:c,subject:t})));return s?e.jsx(k.Loading,{}):a||!t?e.jsx(k.Error,{}):e.jsx(k.Protect,{permissions:n,children:({permissions:c})=>e.jsx(rt,{permissions:c,children:e.jsx(Et,{},t)})})};export{Et as ListViewPage,vt as ProtectedListViewPage};
