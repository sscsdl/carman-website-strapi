import{a as L,j as e,X as A,Y as x,I as l,T as W,Z as B,o as q,a_ as O,P as m,p as F,q as U,r as T,u as $,w as z,Q as H,c9 as V,L as D,z as Q,aI as _,S as J,bE as K,bF as f,bH as X,W as Y,ca as Z,_ as G,bD as ee,bJ as se,bK as te,bL as ne,cb as ae,A as oe}from"./strapi-D0ivxu6x.js";import{S as ie}from"./SearchInput-BlCSDN9b.js";import{u as le}from"./useAdminRoles-CYsXOyWI.js";import{s as re}from"./selectors-MEKBT33G.js";const de=({id:s,name:a,description:n,usersCount:c,icons:u,rowIndex:j,canUpdate:g,cursor:h})=>{const{formatMessage:r}=L(),[,C]=u,d=r({id:"Roles.RoleRow.user-count",defaultMessage:"{number, plural, =0 {#  user} one {#  user} other {# users}}"},{number:c});return e.jsxs(A,{cursor:h,"aria-rowindex":j,onClick:g?C.onClick:void 0,children:[e.jsx(x,{maxWidth:"13rem",children:e.jsx(l,{ellipsis:!0,textColor:"neutral800",children:a})}),e.jsx(x,{maxWidth:"25rem",children:e.jsx(l,{ellipsis:!0,textColor:"neutral800",children:n})}),e.jsx(x,{children:e.jsx(l,{textColor:"neutral800",children:d})}),e.jsx(x,{children:e.jsx(W,{justifyContent:"flex-end",onClick:o=>o.stopPropagation(),children:u.map((o,p)=>o?e.jsx(B,{paddingLeft:p===0?0:1,children:e.jsx(q,{...o,variant:"ghost"})},o.label):null)})})]},s)},ce=()=>{const{formatMessage:s}=L(),a=O(re),{formatAPIError:n}=F(),{toggleNotification:c}=U(),[u,j]=T.useState(!1),[{query:g}]=$(),{isLoading:h,allowedActions:{canCreate:r,canDelete:C,canRead:d,canUpdate:o}}=z(a.settings?.roles),{roles:p,refetch:w}=le({filters:g?._q?{name:{$containsi:g._q}}:void 0},{refetchOnMountOrArgChange:!0,skip:h||!d}),E=H(),[{roleToDelete:k},b]=T.useReducer(ge,ue),{post:P}=V(),S=async()=>{try{b({type:"ON_REMOVE_ROLES"}),await P("/admin/roles/batch-delete",{ids:[k]}),await w(),b({type:"RESET_DATA_TO_DELETE"})}catch(t){oe(t)&&c({type:"danger",message:n(t)})}},R=()=>E("new"),M=()=>j(t=>!t),y=t=>i=>{i.preventDefault(),i.stopPropagation(),t.usersCount?c({type:"info",message:s({id:"Roles.ListPage.notification.delete-not-allowed"})}):(b({type:"SET_ROLE_TO_DELETE",id:t.id}),M())},I=t=>i=>{i.preventDefault(),i.stopPropagation(),E(`duplicate/${t.id}`)},v=p.length+1,N=6;return h?e.jsx(m.Loading,{}):e.jsxs(m.Main,{children:[e.jsx(m.Title,{children:s({id:"Settings.PageTitle",defaultMessage:"Settings - {name}"},{name:"Roles"})}),e.jsx(D.Header,{primaryAction:r?e.jsx(Q,{onClick:R,startIcon:e.jsx(_,{}),size:"S",fullWidth:!0,children:s({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})}):null,title:s({id:"global.roles",defaultMessage:"roles"}),subtitle:s({id:"Settings.roles.list.description",defaultMessage:"List of roles"})}),d&&e.jsx(D.Action,{startActions:e.jsx(ie,{label:s({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:s({id:"global.roles",defaultMessage:"roles"})})})}),d&&e.jsx(D.Content,{children:e.jsxs(J,{colCount:N,rowCount:v,footer:r?e.jsx(se,{cursor:"pointer",onClick:R,icon:e.jsx(_,{}),children:s({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})}):null,children:[e.jsx(K,{children:e.jsxs(A,{"aria-rowindex":1,children:[e.jsx(f,{children:e.jsx(l,{variant:"sigma",textColor:"neutral600",children:s({id:"global.name",defaultMessage:"Name"})})}),e.jsx(f,{children:e.jsx(l,{variant:"sigma",textColor:"neutral600",children:s({id:"global.description",defaultMessage:"Description"})})}),e.jsx(f,{children:e.jsx(l,{variant:"sigma",textColor:"neutral600",children:s({id:"global.users",defaultMessage:"Users"})})}),e.jsx(f,{children:e.jsx(X,{children:s({id:"global.actions",defaultMessage:"Actions"})})})]})}),e.jsx(Y,{children:p?.map((t,i)=>e.jsx(de,{cursor:"pointer",id:t.id,name:t.name,description:t.description,usersCount:t.usersCount,icons:[r&&{onClick:I(t),label:s({id:"app.utils.duplicate",defaultMessage:"Duplicate"}),children:e.jsx(Z,{})},o&&{onClick:()=>E(t.id.toString()),label:s({id:"app.utils.edit",defaultMessage:"Edit"}),children:e.jsx(G,{})},C&&{onClick:y(t),label:s({id:"global.delete",defaultMessage:"Delete"}),children:e.jsx(ee,{})}].filter(Boolean),rowIndex:i+2,canUpdate:o},t.id))})]})}),e.jsx(te.Root,{open:u,onOpenChange:M,children:e.jsx(ne,{onConfirm:S})})]})},ue={roleToDelete:null,showModalConfirmButtonLoading:!1,shouldRefetchData:!1},ge=(s,a)=>ae(s,n=>{switch(a.type){case"ON_REMOVE_ROLES":{n.showModalConfirmButtonLoading=!0;break}case"ON_REMOVE_ROLES_SUCCEEDED":{n.shouldRefetchData=!0,n.roleToDelete=null;break}case"RESET_DATA_TO_DELETE":{n.shouldRefetchData=!1,n.roleToDelete=null,n.showModalConfirmButtonLoading=!1;break}case"SET_ROLE_TO_DELETE":{n.roleToDelete=a.id;break}default:return n}}),me=()=>{const s=O(a=>a.admin_app.permissions.settings?.roles.read);return e.jsx(m.Protect,{permissions:s,children:e.jsx(ce,{})})};export{ce as ListPage,me as ProtectedListPage};
