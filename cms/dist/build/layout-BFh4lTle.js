import{j as e,Z as M,g as A,T as f,dk as U,I as R,o as E,bD as Y,V as W,l as z,dL as K,dM as J,$ as Z,dN as q,C as X,q as ee,ak as te,a$ as se,a as P,p as ne,aE as y,a3 as ae,aB as ie,r as b,dO as re,dP as oe,dQ as le,aR as ce,dR as de,dS as ue,dT as pe,bk as ge,dU as h,bo as D,n as he,c as fe,aJ as me,dV as ye,aN as xe,P as S,aO as I,L as je,dW as Te,dX as C}from"./strapi-D0ivxu6x.js";import{u as Le}from"./useDragLayer-HTEwQh_7.js";import{C as be}from"./CardDragPreview-DaYo05Ap.js";import{a as Ce,u as O}from"./hooks-DlkdeZm2.js";function Se(s,n,r){if(!s||!n||!r)return{display:"none"};const{x:t,y:d}=r;return{transform:`translate(${t}px, ${d}px)`}}const Me=({renderItem:s})=>{const{itemType:n,isDragging:r,item:t,initialOffset:d,currentOffset:p,mouseOffset:c}=Le(i=>({item:i.getItem(),itemType:i.getItemType(),initialOffset:i.getInitialSourceClientOffset(),currentOffset:i.getSourceClientOffset(),isDragging:i.isDragging(),mouseOffset:i.getClientOffset()}));return r?e.jsx(M,{height:"100%",left:0,position:"fixed",pointerEvents:"none",top:0,zIndex:100,width:"100%",children:e.jsx(M,{style:Se(d,p,c),children:s({type:n,item:t})})}):null},ke=({displayedValue:s})=>{const n=A();return e.jsxs(f,{background:"neutral0",borderColor:"neutral200",justifyContent:"space-between",gap:3,padding:3,width:"30rem",children:[e.jsx(Ie,{type:"button",children:e.jsxs(f,{gap:6,children:[e.jsx(De,{alignItems:"center",justifyContent:"center",background:"neutral200",height:"3.2rem",width:"3.2rem",children:e.jsx(U,{})}),e.jsx(f,{maxWidth:"15rem",children:e.jsx(R,{textColor:"neutral700",ellipsis:!0,children:s})})]})}),e.jsxs(f,{gap:2,children:[e.jsx(E,{withTooltip:!1,label:"",variant:"ghost",children:e.jsx(Y,{})}),n&&e.jsx(E,{withTooltip:!1,label:"",variant:"ghost",children:e.jsx(W,{})})]})]})},De=z(f)`
  border-radius: 50%;

  svg {
    height: 0.6rem;
    width: 1.1rem;
    > path {
      fill: ${({theme:s})=>s.colors.neutral600};
    }
  }
`,Ie=z.button`
  border: none;
  background: transparent;
  display: block;
  width: 100%;
  text-align: unset;
  padding: 0;
`,Ee=({status:s,displayedValue:n,width:r})=>{const t=A();return e.jsx(M,{style:{width:r},children:e.jsxs(f,{paddingTop:2,paddingBottom:2,paddingLeft:2,paddingRight:4,hasRadius:!0,borderWidth:1,background:"neutral0",borderColor:"neutral200",justifyContent:"space-between",gap:4,children:[e.jsxs(K,{gap:1,children:[t&&e.jsx(E,{withTooltip:!1,label:"",variant:"ghost",children:e.jsx(W,{})}),e.jsxs(f,{width:"100%",minWidth:0,justifyContent:"space-between",children:[e.jsx(M,{minWidth:0,paddingTop:1,paddingBottom:1,paddingRight:4,children:e.jsx(J,{href:"",children:e.jsx(R,{textColor:"primary600",ellipsis:!0,children:n})})}),s?e.jsx(Z,{status:s}):null]})]}),e.jsx(q,{type:"button",children:e.jsx(X,{width:"12px"})})]})})},{MUTATE_COLLECTION_TYPES_LINKS:Oe,MUTATE_SINGLE_TYPES_LINKS:Pe}=oe,F=()=>{const{toggleNotification:s}=ee(),n=Ce(),r=te("useContentManagerInitData",g=>g.runHookWaterfall),{notifyStatus:t}=se(),{formatMessage:d}=P(),{_unstableFormatAPIError:p}=ne(y),c=ae("useContentManagerInitData",g=>g.checkUserHasPermissions),i=O(g=>g["content-manager"].app),a=ie(void 0,{refetchOnMountOrArgChange:!0});b.useEffect(()=>{a.data&&t(d({id:y("App.schemas.data-loaded"),defaultMessage:"The schemas have been successfully loaded."}))},[d,a.data,t]),b.useEffect(()=>{a.error&&s({type:"danger",message:p(a.error)})},[p,a.error,s]);const o=re();b.useEffect(()=>{o.error&&s({type:"danger",message:p(o.error)})},[p,o.error,s]);const x=async(g,T,j,l)=>{const{collectionType:u,singleType:k}=T.reduce((m,L)=>(m[L.kind].push(L),m),{collectionType:[],singleType:[]}),w=v(u,"collectionTypes",l),N=v(k,"singleTypes"),H=await Promise.all(w.map(({permissions:m})=>c(m))),$=w.filter((m,L)=>H[L].length>0),B=await Promise.all(N.map(({permissions:m})=>c(m))),Q=N.filter((m,L)=>B[L].length>0),{ctLinks:V}=r(Oe,{ctLinks:$,models:T}),{stLinks:G}=r(Pe,{stLinks:Q,models:T});n(le({authorizedCollectionTypeLinks:V,authorizedSingleTypeLinks:G,components:g,contentTypeSchemas:T,fieldSizes:j}))};return b.useEffect(()=>{a.data&&o.data&&x(a.data.components,a.data.contentTypes,a.data.fieldSizes,o.data)},[a.data,o.data]),{...i}},v=(s,n,r=[])=>s.filter(t=>t.isDisplayed).map(t=>{const d=[{action:"plugin::content-manager.explorer.create",subject:t.uid},{action:"plugin::content-manager.explorer.read",subject:t.uid}],p=[{action:"plugin::content-manager.explorer.read",subject:t.uid}],c=n==="collectionTypes"?d:p,i=r.find(({uid:o})=>o===t.uid);let a=null;if(i){const o={page:1,pageSize:i.settings.pageSize,sort:`${i.settings.defaultSortBy}:${i.settings.defaultSortOrder}`};a=ce.stringify(o,{encode:!1})}return{permissions:c,search:a,kind:t.kind,title:t.info.displayName,to:`/content-manager/${t.kind==="collectionType"?de:ue}/${t.uid}`,uid:t.uid,name:t.uid,isDisplayed:t.isDisplayed}}),_=({isFullPage:s=!1})=>{const[n,r]=b.useState(""),{formatMessage:t,locale:d}=P(),{isLoading:p}=F(),c=O(l=>l["content-manager"].app.collectionTypeLinks),i=O(l=>l["content-manager"].app.singleTypeLinks),{contains:a}=pe(d,{sensitivity:"base"}),o=ge(d,{sensitivity:"base"}),x=b.useMemo(()=>[{id:"collectionTypes",title:t({id:y("components.LeftMenu.collection-types"),defaultMessage:"Collection Types"}),searchable:!0,links:c},{id:"singleTypes",title:t({id:y("components.LeftMenu.single-types"),defaultMessage:"Single Types"}),searchable:!0,links:i}].map(l=>({...l,links:l.links.filter(u=>a(u.title,n.trim())).sort((u,k)=>o.compare(u.title,k.title)).map(u=>({...u,title:t({id:u.title,defaultMessage:u.title})}))})),[c,n,i,a,t,o]),g=()=>{r("")},T=l=>{r(l.target.value)},j=t({id:y("header.name"),defaultMessage:"Content Manager"});return p?e.jsxs(h.Main,{"aria-label":j,children:[e.jsx(h.Header,{label:j}),e.jsx(D,{}),e.jsx(f,{padding:4,justifyContent:"center",children:e.jsx(he,{})})]}):e.jsxs(h.Main,{"aria-label":j,children:[!s&&e.jsxs(e.Fragment,{children:[e.jsx(h.Header,{label:j}),e.jsx(D,{})]}),e.jsxs(h.Content,{children:[s&&e.jsxs(e.Fragment,{children:[e.jsx(h.Header,{label:j}),e.jsx(D,{})]}),e.jsx(f,{paddingLeft:{initial:3,large:5},paddingRight:{initial:3,large:5},paddingTop:5,paddingBottom:{initial:1,large:0},gap:3,direction:"column",alignItems:"stretch",children:e.jsx(fe,{value:n,onChange:T,onClear:g,placeholder:t({id:"search.placeholder",defaultMessage:"Search"}),size:"S",children:void 0,name:"search_contentType",clearLabel:t({id:"clearLabel",defaultMessage:"Clear"})})}),e.jsx(h.Sections,{children:x.map(l=>e.jsx(h.Section,{label:l.title,badgeLabel:l.links.length.toString(),children:l.links.map(u=>e.jsx(h.Link,{to:{pathname:u.to},label:u.title},u.uid))},l.id))})]})]})},Re=()=>{const s=me("/content-manager/:kind/:uid/*"),n=ye(),{isLoading:r,collectionTypeLinks:t,models:d,singleTypeLinks:p}=F(),c=[...t,...p].sort((x,g)=>x.title.localeCompare(g.title)),{pathname:i}=xe(),{formatMessage:a}=P();if(r)return e.jsxs(e.Fragment,{children:[e.jsx(S.Title,{children:a({id:y("plugin.name"),defaultMessage:"Content Manager"})}),e.jsx(S.Loading,{})]});const o=d.filter(({isDisplayed:x})=>x);return c.length===0&&o.length>0&&i!=="/content-manager/403"?e.jsx(I,{to:"/403"}):o.length===0&&i!=="/no-content-types"?e.jsx(I,{to:"/no-content-types"}):!s&&c.length>0?n?e.jsxs(e.Fragment,{children:[e.jsx(S.Title,{children:a({id:y("plugin.name"),defaultMessage:"Content Manager"})}),e.jsx(h.PageWrapper,{children:e.jsx(_,{isFullPage:!0})})]}):e.jsx(I,{to:{pathname:c[0].to,search:c[0].search??""},replace:!0}):e.jsxs(e.Fragment,{children:[e.jsx(S.Title,{children:a({id:y("plugin.name"),defaultMessage:"Content Manager"})}),e.jsxs(je.Root,{sideNav:e.jsx(_,{}),children:[e.jsx(Me,{renderItem:we}),e.jsx(Te,{})]})]})};function we({type:s,item:n}){if(!s||s&&typeof s!="string")return null;const[r]=s.split("_");switch(r){case C.EDIT_FIELD:case C.FIELD:return e.jsx(be,{label:n.label});case C.COMPONENT:case C.DYNAMIC_ZONE:return e.jsx(ke,{displayedValue:n.displayedValue});case C.RELATION:return e.jsx(Ee,{...n});default:return null}}export{Re as Layout};
