import{r as z,a as M,ai as X,aj as J,j as e,aN as H,x as W,co as x,bv as K,bw as V,T as y,H as g,aY as ee,Z as S,bG as te,I as D,cU as ae,cV as se,z as E,cW as ne,cX as ie,D as re,E as oe,q as le,Q as de,p as ce,u as ue,cY as me,s as ge,cZ as he,bS as fe,b as pe,w as xe,c_ as je,P as B,L as w,aT as be,aI as Re,G as Ce,bW as q,c$ as R,bo as ze,cB as L,l as I,d0 as Me,aF as Te,K as Se,U as $,aH as ye,a5 as ve,A as we}from"./strapi-D0ivxu6x.js";import{t as Le,a as De,R as Ee,z as Ie}from"./schemas-Blgsjo6g.js";import{f as Ae}from"./index-DJfLSYOx.js";import{f as ke}from"./index-B8zY1Cef.js";function Pe(o,a,m){var s=Le(o,m),n=De(a,s,!0),t=new Date(s.getTime()-n),u=new Date(0);return u.setFullYear(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()),u.setHours(t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds()),u}const Ue=["years","months","days","hours","minutes","seconds"],Ne=z.forwardRef(({timestamp:o,customIntervals:a=[],...m},s)=>{const{formatRelativeTime:n,formatDate:t,formatTime:u}=M(),r=X({start:o,end:Date.now()}),h=Ue.find(i=>r[i]>0&&Object.keys(r).includes(i)),d=J(o)?-r[h]:r[h],p=a.find(i=>r[i.unit]<i.threshold),j=p?p.text:n(d,h,{numeric:"auto"});return e.jsx("time",{ref:s,dateTime:o.toISOString(),role:"time",title:`${t(o)} ${u(o)}`,...m,children:j})}),$e=({handleClose:o,open:a,handleSubmit:m,initialValues:s,isLoading:n=!1})=>{const{formatMessage:t}=M(),{pathname:u}=H(),r=u===`/plugins/${ne}`,{timezoneList:h,systemTimezone:d={value:"UTC+00:00-Africa/Abidjan "}}=W(s.scheduledAt?new Date(s.scheduledAt):new Date),p=i=>{const{date:c,time:b,timezone:l}=i;if(!c||!b||!l)return null;const f=l.split("&")[1];return Ie(`${c} ${b}`,f)},j=()=>h.find(c=>c.value.split("&")[1]===s.timezone)?.value||d.value;return e.jsx(x.Root,{open:a,onOpenChange:o,children:e.jsxs(x.Content,{children:[e.jsx(x.Header,{children:e.jsx(x.Title,{children:t({id:"content-releases.modal.title",defaultMessage:"{isCreatingRelease, select, true {New release} other {Edit release}}"},{isCreatingRelease:r})})}),e.jsx(K,{onSubmit:i=>{m({...i,timezone:i.timezone?i.timezone.split("&")[1]:null,scheduledAt:i.isScheduled?p(i):null})},initialValues:{...s,timezone:s.timezone?j():d.value},validationSchema:Ee,validateOnChange:!1,children:({values:i,errors:c,handleChange:b,setFieldValue:l})=>e.jsxs(V,{children:[e.jsx(x.Body,{children:e.jsxs(y,{direction:"column",alignItems:"stretch",gap:6,children:[e.jsxs(g.Root,{name:"name",error:c.name&&t({id:c.name,defaultMessage:c.name}),required:!0,children:[e.jsx(g.Label,{children:t({id:"content-releases.modal.form.input.label.release-name",defaultMessage:"Name"})}),e.jsx(ee,{type:"text",value:i.name,onChange:b}),e.jsx(g.Error,{})]}),e.jsx(S,{width:"max-content",children:e.jsx(te,{name:"isScheduled",checked:i.isScheduled,onCheckedChange:f=>{l("isScheduled",f),f?(l("date",s.date),l("time",s.time),l("timezone",s.timezone??d?.value)):(l("date",null),l("time",""),l("timezone",null))},children:e.jsx(D,{textColor:i.isScheduled?"primary600":"neutral800",fontWeight:i.isScheduled?"semiBold":"regular",children:t({id:"modal.form.input.label.schedule-release",defaultMessage:"Schedule release"})})})}),i.isScheduled&&e.jsxs(e.Fragment,{children:[e.jsxs(y,{gap:4,alignItems:"start",direction:{initial:"column",medium:"row"},wrap:"wrap",children:[e.jsx(S,{width:"100%",flex:1,children:e.jsxs(g.Root,{name:"date",error:c.date&&t({id:c.date,defaultMessage:c.date}),required:!0,children:[e.jsx(g.Label,{children:t({id:"content-releases.modal.form.input.label.date",defaultMessage:"Date"})}),e.jsx(ae,{onChange:f=>{const v=f?Ae(f,{representation:"date"}):null;l("date",v)},clearLabel:t({id:"content-releases.modal.form.input.clearLabel",defaultMessage:"Clear"}),onClear:()=>{l("date",null)},value:i.date?new Date(i.date):new Date,minDate:Pe(new Date,i.timezone.split("&")[1])}),e.jsx(g.Error,{})]})}),e.jsx(S,{width:"100%",flex:1,children:e.jsxs(g.Root,{name:"time",error:c.time&&t({id:c.time,defaultMessage:c.time}),required:!0,children:[e.jsx(g.Label,{children:t({id:"content-releases.modal.form.input.label.time",defaultMessage:"Time"})}),e.jsx(se,{onChange:f=>{l("time",f)},clearLabel:t({id:"content-releases.modal.form.input.clearLabel",defaultMessage:"Clear"}),onClear:()=>{l("time","")},value:i.time||void 0}),e.jsx(g.Error,{})]})})]}),e.jsx(Oe,{timezoneOptions:h})]})]})}),e.jsxs(x.Footer,{children:[e.jsx(x.Close,{children:e.jsx(E,{variant:"tertiary",name:"cancel",children:t({id:"cancel",defaultMessage:"Cancel"})})}),e.jsx(E,{name:"submit",loading:n,type:"submit",children:t({id:"content-releases.modal.form.button.submit",defaultMessage:"{isCreatingRelease, select, true {Continue} other {Save}}"},{isCreatingRelease:r})})]})]})})]})})},Oe=({timezoneOptions:o})=>{const{values:a,errors:m,setFieldValue:s}=ie(),{formatMessage:n}=M(),[t,u]=z.useState(o);return z.useEffect(()=>{if(a.date){const{timezoneList:r}=W(new Date(a.date));u(r);const h=a.timezone&&r.find(d=>d.value.split("&")[1]===a.timezone.split("&")[1]);h&&s("timezone",h.value)}},[s,a.date,a.timezone]),e.jsxs(g.Root,{name:"timezone",error:m.timezone&&n({id:m.timezone,defaultMessage:m.timezone}),required:!0,children:[e.jsx(g.Label,{children:n({id:"content-releases.modal.form.input.label.timezone",defaultMessage:"Timezone"})}),e.jsx(re,{autocomplete:{type:"list",filter:"contains"},value:a.timezone||void 0,textValue:a.timezone?a.timezone.replace(/&/," "):void 0,onChange:r=>{s("timezone",r)},onTextValueChange:r=>{s("timezone",r)},onClear:()=>{s("timezone","")},children:t.map(r=>e.jsx(oe,{value:r.value,children:r.value.replace(/&/," ")},r.value))}),e.jsx(g.Error,{})]})},He=I(q)`
  display: block;
`,We=I(Ne)`
  display: inline-block;
  &::first-letter {
    text-transform: uppercase;
  }
`,Be=o=>{let a;switch(o){case"ready":a="success";break;case"blocked":a="warning";break;case"failed":a="danger";break;case"done":a="primary";break;case"empty":default:a="neutral"}return{textColor:`${a}600`,backgroundColor:`${a}100`,borderColor:`${a}200`}},O=({sectionTitle:o,releases:a=[],isError:m=!1})=>{const{formatMessage:s}=M();return m?e.jsx(B.Error,{}):a?.length===0?e.jsx(Te,{content:s({id:"content-releases.page.Releases.tab.emptyEntries",defaultMessage:"No releases"},{target:o}),icon:e.jsx(Se,{width:"16rem"})}):e.jsx($.Root,{gap:4,children:a.map(({id:n,name:t,scheduledAt:u,status:r})=>e.jsx($.Item,{col:3,s:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(He,{tag:ye,to:`${n}`,isExternal:!1,children:e.jsxs(y,{direction:"column",justifyContent:"space-between",padding:4,hasRadius:!0,background:"neutral0",shadow:"tableShadow",height:"100%",width:"100%",alignItems:"start",gap:4,children:[e.jsxs(y,{direction:"column",alignItems:"start",gap:1,children:[e.jsx(D,{textColor:"neutral800",tag:"h3",variant:"delta",fontWeight:"bold",children:t}),e.jsx(D,{variant:"pi",textColor:"neutral600",children:u?e.jsx(We,{timestamp:new Date(u)}):s({id:"content-releases.pages.Releases.not-scheduled",defaultMessage:"Not scheduled"})})]}),e.jsx(ve,{...Be(r),children:r})]})})},n))})},qe=I(Me)`
  button {
    display: none;
  }
  p + div {
    margin-left: auto;
  }
`,Fe={name:"",date:ke(new Date,"yyyy-MM-dd"),time:"",isScheduled:!0,scheduledAt:null,timezone:null},Ze=()=>{const o=H(),[a,m]=z.useState(!1),{toggleNotification:s}=le(),{formatMessage:n}=M(),t=de(),{formatAPIError:u}=ce(),[{query:r},h]=ue(),d=me(r),{data:p,isLoading:j}=ge(),[i,{isLoading:c}]=he(),{getFeature:b}=fe(),{maximumReleases:l=3}=b("cms-content-releases"),{trackUsage:f}=pe(),{allowedActions:{canCreate:v}}=xe(je),{isLoading:A,isSuccess:F,isError:k}=d,G=d?.currentData?.meta?.activeTab||"pending";z.useEffect(()=>{o?.state?.errors&&(s({type:"danger",title:n({id:"content-releases.pages.Releases.notification.error.title",defaultMessage:"Your request could not be processed."}),message:n({id:"content-releases.pages.Releases.notification.error.message",defaultMessage:"Please try again or open another release."})}),t("",{replace:!0,state:null}))},[n,o?.state?.errors,t,s]);const P=()=>{m(C=>!C)};if(A||j)return e.jsx(B.Loading,{});const U=F&&d.currentData?.meta?.pendingReleasesCount||0,N=U>=l,Y=C=>{h({...r,page:1,pageSize:d?.currentData?.meta?.pagination?.pageSize||16,filters:{releasedAt:{$notNull:C!=="pending"}}})},Q=async({name:C,scheduledAt:_,timezone:Z})=>{const T=await i({name:C,scheduledAt:_,timezone:Z});"data"in T?(s({type:"success",message:n({id:"content-releases.modal.release-created-notification-success",defaultMessage:"Release created."})}),f("didCreateRelease"),t(T.data.data.id.toString())):we(T.error)?s({type:"danger",message:u(T.error)}):s({type:"danger",message:n({id:"notification.error",defaultMessage:"An error occurred"})})};return e.jsx(w.Root,{children:e.jsxs(be,{"aria-busy":A||j,children:[e.jsx(w.Header,{title:n({id:"content-releases.pages.Releases.title",defaultMessage:"Releases"}),secondaryAction:e.jsx(Ce,{label:n({id:"components.premiumFeature.title",defaultMessage:"Premium feature"})}),subtitle:n({id:"content-releases.pages.Releases.header-subtitle",defaultMessage:"Create and manage content updates"}),primaryAction:v?e.jsx(E,{startIcon:e.jsx(Re,{}),onClick:P,disabled:N,fullWidth:!0,children:n({id:"content-releases.header.actions.add-release",defaultMessage:"New release"})}):null}),e.jsx(w.Content,{children:e.jsxs(e.Fragment,{children:[N&&e.jsx(qe,{marginBottom:6,action:e.jsx(q,{href:"https://strapi.io/pricing-cloud",isExternal:!0,children:n({id:"content-releases.pages.Releases.max-limit-reached.action",defaultMessage:"Explore plans"})}),title:n({id:"content-releases.pages.Releases.max-limit-reached.title",defaultMessage:"You have reached the {number} pending {number, plural, one {release} other {releases}} limit."},{number:l}),onClose:()=>{},closeLabel:"",children:n({id:"content-releases.pages.Releases.max-limit-reached.message",defaultMessage:"Upgrade to manage an unlimited number of releases."})}),e.jsxs(R.Root,{variant:"simple",onValueChange:Y,value:G,children:[e.jsxs(S,{paddingBottom:8,children:[e.jsxs(R.List,{"aria-label":n({id:"content-releases.pages.Releases.tab-group.label",defaultMessage:"Releases list"}),children:[e.jsx(R.Trigger,{value:"pending",children:n({id:"content-releases.pages.Releases.tab.pending",defaultMessage:"Pending ({count})"},{count:U})}),e.jsx(R.Trigger,{value:"done",children:n({id:"content-releases.pages.Releases.tab.done",defaultMessage:"Done"})})]}),e.jsx(ze,{})]}),e.jsx(R.Content,{value:"pending",children:e.jsx(O,{sectionTitle:"pending",releases:d?.currentData?.data,isError:k})}),e.jsx(R.Content,{value:"done",children:e.jsx(O,{sectionTitle:"done",releases:d?.currentData?.data,isError:k})})]}),e.jsxs(L.Root,{...d?.currentData?.meta?.pagination,defaultPageSize:d?.currentData?.meta?.pagination?.pageSize,children:[e.jsx(L.PageSize,{options:["8","16","32","64"]}),e.jsx(L.Links,{})]})]})}),e.jsx($e,{open:a,handleClose:P,handleSubmit:Q,isLoading:c,initialValues:{...Fe,timezone:p?.data.defaultTimezone?p.data.defaultTimezone.split("&")[1]:null}})]})})};export{Ne as R,$e as a,Ze as b,Be as g,Pe as u};
